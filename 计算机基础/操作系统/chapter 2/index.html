
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Content and ambitious, gentle yet firm.">
      
      
        <meta name="author" content="Weary Bird">
      
      
        <link rel="canonical" href="https://juanniaoxx.github.io/kaoyan-note/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/chapter%202/">
      
      
        <link rel="prev" href="../chapter%201/">
      
      
        <link rel="next" href="../chapter%203/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.15">
    
    
      
        <title>进程和线程 - Postgraduate Entrance Examination Notes</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="../../../stylesheets/link.css">
    
      <link rel="stylesheet" href="../../../stylesheets/customize.css">
    
      <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.css">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-webfont@1.1.0/style.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="Postgraduate Entrance Examination Notes" class="md-header__button md-logo" aria-label="Postgraduate Entrance Examination Notes" data-md-component="logo">
      
  <img src="http://www.huixueba.net/Content/WebImage/day_191009/201910091021452744_watermark.jpg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Postgraduate Entrance Examination Notes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              进程和线程
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="关闭自动模式"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="关闭自动模式" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo"  aria-label="切换至夜间模式"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="切换至夜间模式" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="切换至日间模式"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="切换至日间模式" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/juanniaoxx" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    Weary Bird
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../tag/" class="md-tabs__link">
        
  
  
    
  
  标签

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../%E8%80%83%E7%BA%B2/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E8%80%83%E7%BA%B2/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E8%80%83%E7%BA%B2.pdf" class="md-tabs__link">
        
  
  
    
  
  计算机基础(408)考纲

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../%E8%80%83%E7%BA%B2/%E6%95%B0%E5%AD%A6%E8%80%83%E7%BA%B2/%E6%95%B0%E5%AD%A6%E4%B8%80%E8%80%83%E7%BA%B2.pdf" class="md-tabs__link">
        
  
  
    
  
  数学一考纲

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../%E6%95%B0%E5%AD%A6%E7%AC%94%E8%AE%B0/%E6%95%B0%E5%AD%A6%E7%AC%94%E8%AE%B0.pdf" class="md-tabs__link">
        
  
  
    
  
  考研数学笔记

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../%E5%86%B2%E5%88%BA150/main.pdf" class="md-tabs__link">
        
  
  
    
  
  冲刺150

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../%E9%94%99%E9%A2%98%E9%9B%86/main.pdf" class="md-tabs__link">
        
  
  
    
  
  数学错题集

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/chapter%201/" class="md-tabs__link">
          
  
  
    
  
  计算机基础(408)

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%A4%A7%E9%A2%98%E7%AC%94%E8%AE%B0/" class="md-tabs__link">
          
  
  
    
  
  历年真题解析

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E8%8B%B1%E8%AF%AD/%E9%98%85%E8%AF%BB/2005/" class="md-tabs__link">
          
  
  
    
  
  英语笔记

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E8%80%83%E7%A0%94%E6%94%BF%E6%B2%BB/%E9%A9%AC%E5%85%8B%E6%80%9D%E4%B8%BB%E4%B9%89%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/" class="md-tabs__link">
          
  
  
    
  
  政治笔记

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Postgraduate Entrance Examination Notes" class="md-nav__button md-logo" aria-label="Postgraduate Entrance Examination Notes" data-md-component="logo">
      
  <img src="http://www.huixueba.net/Content/WebImage/day_191009/201910091021452744_watermark.jpg" alt="logo">

    </a>
    Postgraduate Entrance Examination Notes
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/juanniaoxx" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    Weary Bird
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tag/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    标签
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E8%80%83%E7%BA%B2/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E8%80%83%E7%BA%B2/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E8%80%83%E7%BA%B2.pdf" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    计算机基础(408)考纲
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E8%80%83%E7%BA%B2/%E6%95%B0%E5%AD%A6%E8%80%83%E7%BA%B2/%E6%95%B0%E5%AD%A6%E4%B8%80%E8%80%83%E7%BA%B2.pdf" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    数学一考纲
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%95%B0%E5%AD%A6%E7%AC%94%E8%AE%B0/%E6%95%B0%E5%AD%A6%E7%AC%94%E8%AE%B0.pdf" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    考研数学笔记
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%86%B2%E5%88%BA150/main.pdf" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    冲刺150
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%94%99%E9%A2%98%E9%9B%86/main.pdf" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    数学错题集
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    计算机基础(408)
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            计算机基础(408)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_1" >
        
          
          <label class="md-nav__link" for="__nav_7_1" id="__nav_7_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    数据结构
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_1">
            <span class="md-nav__icon md-icon"></span>
            数据结构
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/chapter%201/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    绪论
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/chapter%202/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    线性表
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/chapter%203/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    栈,队列与数组
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/chapter%204/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    串
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/chapter%205/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    树与二叉树
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/chapter%206/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    图与图算法
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/chapter%207/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    查找
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/chapter%208/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    排序
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_2" >
        
          
          <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    计算机网络
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            计算机网络
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/chapter%201/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    绪论
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/chapter%202/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    数据通信基础
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/chapter%203/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    物理层
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/chapter%204/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    数据链路层
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/chapter%205/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    网络层
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/chapter%206/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    传输层
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/chapter%207/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    应用层
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_3" >
        
          
          <label class="md-nav__link" for="__nav_7_3" id="__nav_7_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    计算机组成原理
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_3">
            <span class="md-nav__icon md-icon"></span>
            计算机组成原理
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/chapter%201/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    绪论
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/chapter%202/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    数据的表示和运算
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/chapter%203/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    存储系统
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/chapter%204/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    指令系统
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/chapter%205/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    中央处理器
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/chapter%206/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    总线
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/chapter%207/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    输入输出系统
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4" checked>
        
          
          <label class="md-nav__link" for="__nav_7_4" id="__nav_7_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    操作系统
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7_4">
            <span class="md-nav__icon md-icon"></span>
            操作系统
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter%201/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    绪论
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    进程和线程
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    进程和线程
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      进程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="进程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      前驱图与程序执行
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      进程的描述
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      进程通信
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      线程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="线程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      线程的实现方式
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      处理机调度
    </span>
  </a>
  
    <nav class="md-nav" aria-label="处理机调度">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      进程调度
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      调度算法
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      死锁
    </span>
  </a>
  
    <nav class="md-nav" aria-label="死锁">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      死锁预防
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      死锁避免
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      死锁的检测与解除
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      进程同步
    </span>
  </a>
  
    <nav class="md-nav" aria-label="进程同步">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      软件同步机制
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      硬件同步机制
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      信号量机制
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      管程机制
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      经典同步问题
    </span>
  </a>
  
    <nav class="md-nav" aria-label="经典同步问题">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#-" class="md-nav__link">
    <span class="md-ellipsis">
      生产者-消费者问题
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-_1" class="md-nav__link">
    <span class="md-ellipsis">
      读者-写者问题
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      哲学家进餐问题
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#new" class="md-nav__link">
    <span class="md-ellipsis">
      (new) 多处理机调度
    </span>
  </a>
  
    <nav class="md-nav" aria-label="(new) 多处理机调度">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      多处理器调度方案
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter%203/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    内存管理
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter%204/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    文件系统
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter%205/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    输入输出管理
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    历年真题解析
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            历年真题解析
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%A4%A7%E9%A2%98%E7%AC%94%E8%AE%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    数据结构大题
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%A4%A7%E9%A2%98%E7%AC%94%E8%AE%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    计算机网络大题
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E5%A4%A7%E9%A2%98%E7%AC%94%E8%AE%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    计算机组成原理大题
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%A4%A7%E9%A2%98%E7%AC%94%E8%AE%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    操作系统大题
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    英语笔记
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            英语笔记
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_9_1" >
        
          
          <label class="md-nav__link" for="__nav_9_1" id="__nav_9_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    阅读
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_1">
            <span class="md-nav__icon md-icon"></span>
            阅读
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E8%8B%B1%E8%AF%AD/%E9%98%85%E8%AF%BB/2005/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2005年阅读
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E8%8B%B1%E8%AF%AD/%E9%98%85%E8%AF%BB/2006/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2006年阅读
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E8%8B%B1%E8%AF%AD/%E9%98%85%E8%AF%BB/2007/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2007年阅读
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E8%8B%B1%E8%AF%AD/%E9%98%85%E8%AF%BB/2008/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2008年阅读
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E8%8B%B1%E8%AF%AD/%E9%98%85%E8%AF%BB/2009/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2009年阅读
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E8%8B%B1%E8%AF%AD/%E9%98%85%E8%AF%BB/2010/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2010年阅读
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E8%8B%B1%E8%AF%AD/%E9%98%85%E8%AF%BB/2011/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2011年阅读
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E8%8B%B1%E8%AF%AD/%E9%98%85%E8%AF%BB/2012/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2012年阅读
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E8%8B%B1%E8%AF%AD/%E9%98%85%E8%AF%BB/2013/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2013年阅读
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E8%8B%B1%E8%AF%AD/%E9%98%85%E8%AF%BB/2014/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2014年阅读
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E8%8B%B1%E8%AF%AD/%E9%98%85%E8%AF%BB/2015/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2015年阅读
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E8%8B%B1%E8%AF%AD/%E9%98%85%E8%AF%BB/2016/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2016年阅读
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E8%8B%B1%E8%AF%AD/%E9%98%85%E8%AF%BB/2017/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2017年阅读
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E8%8B%B1%E8%AF%AD/%E9%98%85%E8%AF%BB/2018/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2018年阅读
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E8%8B%B1%E8%AF%AD/%E9%98%85%E8%AF%BB/2019/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2019年阅读
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E8%8B%B1%E8%AF%AD/%E9%98%85%E8%AF%BB/2020/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2020年阅读
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E8%8B%B1%E8%AF%AD/%E9%98%85%E8%AF%BB/2021/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2021年阅读
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E8%8B%B1%E8%AF%AD/%E9%98%85%E8%AF%BB/2022/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2022年阅读
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E8%8B%B1%E8%AF%AD/%E9%98%85%E8%AF%BB/2023/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2023年阅读
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E8%8B%B1%E8%AF%AD/%E9%98%85%E8%AF%BB/2024/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2024年阅读
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E8%8B%B1%E8%AF%AD/%E9%98%85%E8%AF%BB/2025/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2025年阅读
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_9_2" >
        
          
          <label class="md-nav__link" for="__nav_9_2" id="__nav_9_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Monkey-外刊
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_2">
            <span class="md-nav__icon md-icon"></span>
            Monkey-外刊
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E8%8B%B1%E8%AF%AD/Monkey-%E9%94%90%E8%AF%BB%E5%A4%96%E5%88%8A/Text1-Text4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Text1-Text4
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    政治笔记
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            政治笔记
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E8%80%83%E7%A0%94%E6%94%BF%E6%B2%BB/%E9%A9%AC%E5%85%8B%E6%80%9D%E4%B8%BB%E4%B9%89%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    马克思主义基本原理
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      进程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="进程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      前驱图与程序执行
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      进程的描述
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      进程通信
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      线程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="线程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      线程的实现方式
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      处理机调度
    </span>
  </a>
  
    <nav class="md-nav" aria-label="处理机调度">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      进程调度
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      调度算法
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      死锁
    </span>
  </a>
  
    <nav class="md-nav" aria-label="死锁">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      死锁预防
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      死锁避免
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      死锁的检测与解除
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      进程同步
    </span>
  </a>
  
    <nav class="md-nav" aria-label="进程同步">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      软件同步机制
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      硬件同步机制
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      信号量机制
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      管程机制
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      经典同步问题
    </span>
  </a>
  
    <nav class="md-nav" aria-label="经典同步问题">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#-" class="md-nav__link">
    <span class="md-ellipsis">
      生产者-消费者问题
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-_1" class="md-nav__link">
    <span class="md-ellipsis">
      读者-写者问题
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      哲学家进餐问题
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#new" class="md-nav__link">
    <span class="md-ellipsis">
      (new) 多处理机调度
    </span>
  </a>
  
    <nav class="md-nav" aria-label="(new) 多处理机调度">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      多处理器调度方案
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <nav class="md-tags" >
    
      
      
      
        <a href="../../../tag/#tag:操作系统" class="md-tag">操作系统</a>
      
    
  </nav>


  
    <a href="https://github.com/juanniaoxx/edit/main/docs/计算机基础/操作系统/chapter 2.md" title="编辑此页" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/juanniaoxx/raw/main/docs/计算机基础/操作系统/chapter 2.md" title="查看本页的源代码" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


<h1 id="_1">进程和线程<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h1>
<p><img alt="" src="../images/%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B.png" /></p>
<h2 id="_2">进程<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<h3 id="_3">前驱图与程序执行<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p><ins class="critic">前驱图</ins> 一个有向无环图(DAG), 用于描述进程间之间执行的先后顺序.</p>
<p><img alt="alt text" src="../images/%E5%89%8D%E9%A9%B1%E5%9B%BE.png" /></p>
<ul>
<li>前驱图不允许有循环(无环)</li>
<li>上述前驱图,存在的前驱关系为 <span class="arithmatex">\(P=\{(P_1,P_2),(P_1,P_2),(P_1,P_3),(P_2,P_5),(P_3,P_5),(P_4,P_6),(P_4,P_7),(P_5,P_8),(P_6,P_8),(P_7,P_9),(P_8,P_9)\}\)</span></li>
</ul>
<p><img alt="alt text" src="../images/%E9%A1%BA%E5%BA%8F%E6%89%A7%E8%A1%8C.png" /></p>
<p><ins class="critic">顺序执行</ins> 一个语句一个语句,按顺次执行.</p>
<ul>
<li>顺序性 严格按照程序所规定的顺序执行</li>
<li>封闭性 程序运行<ins class="critic">独占</ins>全机资源,只有本程序才能改变资源的状态</li>
<li>可再现性 只要程序执行环境和初始条件相同,都可以获得相同的结果</li>
</ul>
<p><img alt="alt text" src="../images/%E5%B9%B6%E5%8F%91%E6%89%A7%E8%A1%8C.png" /></p>
<ul>
<li>间断性</li>
<li>失去封闭性</li>
<li>不可再现性(异步)</li>
</ul>
<h3 id="_4">进程的描述<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<p>通常<ins class="critic">程序</ins>是不能参与并发执行,于是在OS中引入了进程的概念.</p>
<p><ins>进程(进程实体,进程映象)</ins> 由程序段,相关的数据段和PCB(进程控制块)组成</p>
<p><ins class="critic">进程的定义</ins> 进程是程序的执行过程,是系统进行资源分配和调度的独立单位.</p>
<ul>
<li>动态性 进程的实质是程序的执行过程;进程有一定的生命周期,由创建而产生,由调度而执行,最后由撤销而消亡,而程序是一段代码并无生命周期.</li>
<li>并发性 </li>
<li>独立性 是一个独立运行,独立获取资源,独立接受调度的基本单位<ul>
<li>凡未建立PCB的程序都<del class="critic">不可以</del>作为独立的单位参与并发执行</li>
</ul>
</li>
<li>异步性</li>
</ul>
<p><ins class="critic">进程的状态切换</ins> 基本状态(三个)就绪状态,执行状态和阻塞状态. 其余状态有创建状态,终止状态,挂起和激活</p>
<p><img alt="alt text" src="../images/%E8%BF%9B%E7%A8%8B%E7%8A%B6%E6%80%81%E7%9A%84%E5%88%87%E6%8D%A2.png" /></p>
<ul>
<li><ins class="critic">就绪状态</ins> 进程已经获得了所有<ins class="critic">除CPU以外</ins>的全部资源,只需要获得CPU就可以立即执行.<ul>
<li>可以由创建态进入,阻塞状态结束,时间片用完导致执行态退出</li>
</ul>
</li>
<li><ins class="critic">执行状态</ins> 进程获得调度,上CPU执行的状态<ul>
<li>进程由调度而执行</li>
</ul>
</li>
<li><ins class="critic">阻塞状态</ins> 进程由于请求I/O或者其他资源从而退出执行状态,进入等待对应资源的状态<ul>
<li>阻塞状态结束后会<ins class="critic">进入就绪状态</ins>而非立即执行.</li>
</ul>
</li>
<li>挂起和激活<ul>
<li>挂起:暂定当前进程的一切活动<ul>
<li>执行态时候挂起会直接进入静止就绪态,即使激活也需要重新调度</li>
</ul>
</li>
<li>激活: 让一个被挂起的程序重新启动</li>
</ul>
</li>
</ul>
<p><ins class="critic">进程管理的数据结构</ins> OS为了方便管理系统的各种资源通常将这些资源抽象为各种数据结构,并提供了一组对应的资源访问指令 </p>
<p><img alt="alt text" src="../images/OS%E6%8E%A7%E5%88%B6%E8%A1%A8%E7%9A%84%E4%B8%80%E8%88%AC%E7%BB%93%E6%9E%84.png" /></p>
<p><ins class="critic">PCB(进程控制块)</ins></p>
<p><img alt="" src="../images/PCB.png" /></p>
<p><ins class="critic">PCB的组织方法</ins> 线性表示,链式队列,索引方式.</p>
<p><img alt="alt text" src="../images/PCB%E7%BB%84%E7%BB%87%E6%96%B9%E5%BC%8F.png" /></p>
<p>会引起进程创建的事件  用户登录;作业调度;提供服务;应用请求</p>
<p><ins class="critic">进程创建的过程</ins></p>
<ul>
<li>申请空白的PCB</li>
<li>为新进程分配器运行所需要的资源</li>
<li>初始化PCB</li>
<li>如果进程就绪队列能接纳新的进程,则插入就绪队列</li>
</ul>
<p>会引起进程终止的事件 正常结束;异常结束;外界干预</p>
<p><ins class="critic">进程终止的过程</ins></p>
<ul>
<li>根据被终止进程的标识符,从PCB集合中检索出该PCB,并从该进程的PCB中读出进程的状态</li>
<li>若被终止的进程处于执行状态,则立刻终止执行,并置调度标志位真,指示该进程被终止后应重新调度</li>
<li>若该进程还有子孙进程,则应终止其所有子孙进程,防止它们称为不可控进程(僵尸进程)</li>
<li>将被终止的进程所拥有的所有资源或归还给其父进程或归还给OS</li>
<li>将被终止的进程的PCB从所在队列(或链表)中移除</li>
</ul>
<h3 id="_5">进程通信<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<p><img alt="" src="../images/%E8%BF%9B%E7%A8%8B%E9%80%9A%E4%BF%A1.png" /></p>
<h2 id="_6">线程<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h2>
<p>引入线程的目的 <ins class="critic">减少程序在并发执行的时候所需要付出的时空开销</ins></p>
<p><img alt="" src="../images/%E8%BF%9B%E7%A8%8BVS%E7%BA%BF%E7%A8%8B.png" /></p>
<p><ins class="critic">多线程支持多处理机系统</ins>而<del class="critic">单进程不支持</del>.</p>
<p>线程通信具有三种基本状态,由其专属的线程控制块(TCB).</p>
<h3 id="_7">线程的实现方式<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<p><img alt="alt text" src="../images/%E7%94%A8%E6%88%B7%E7%BA%A7%E7%BA%BF%E7%A8%8BVS%E7%B3%BB%E7%BB%9F%E7%BA%A7%E7%BA%BF%E7%A8%8B.png" /></p>
<p>通常来说现代OS会将用户级线程和系统级线程组合在一起使用,由如下三种类型.</p>
<p><img alt="alt text" src="../images/%E7%BB%84%E5%90%88%E6%96%B9%E5%BC%8F%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B.png" /></p>
<h2 id="_8">处理机调度<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h2>
<p>调度的本质是一种<ins class="critic">资源分配</ins></p>
<p>处理机调度的三个层次 </p>
<ul>
<li><ins class="critic">低级调度</ins> 即进程调度, 根据某种算法决定那个进程获取CPU资源</li>
<li><ins class="critic">中级调度</ins> 即内存调度, 存储器管理的对换功能</li>
<li><ins class="critic">高级调度</ins> 即作业调度, 根据某种算法将位于外存上处于后备队列中的那几个作业调入内存</li>
</ul>
<h3 id="_9">进程调度<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<p>主要任务 <ins class="critic">保存CPU现场信息</ins> <ins class="critic">按照某种算法选取进程</ins> <ins class="critic">把CPU分配给进程</ins></p>
<p><img alt="alt text" src="../images/%E8%BF%9B%E7%A8%8B%E8%B0%83%E5%BA%A6%E7%A8%8B%E5%BA%8F.png" /></p>
<p><ins class="critic">进程调度程序的组成</ins></p>
<ul>
<li>排队器 将就绪进程按照一定策略排列成一个或者多个队列,以便调度程序可以快速找到它们</li>
<li>分配器 将选定的进程从就绪队列中取出,然后进行分配器到新进程间的<ins class="critic">上下文切换</ins>,将CPU分配给新的进程</li>
<li>上下文切换器 <ul>
<li>当前进程和分配器的切换</li>
<li>分配程序和待调度进行的上下文切换</li>
</ul>
</li>
</ul>
<p><ins class="critic">调度算法的共同目标</ins></p>
<ul>
<li>资源利用路 </li>
</ul>
<div class="arithmatex">\[
CPU利用率=\frac{CPU有效时间}{CPU有效时间+CPU空闲等待时间}
\]</div>
<ul>
<li>公平性 各进程都可以合理的获取CPU资源</li>
<li>平衡性 尽可能保证系统资源的平衡性(合理分配资源给不同类型的作业,例如有的属于CPU繁忙作业,有的属于I/O繁忙作业)</li>
<li>策略强制执行 </li>
</ul>
<p><ins class="critic">周转时间</ins> 从作业被提交给系统开始,到作业完成为止的这段时间间隔.</p>
<div class="arithmatex">\[
T_{周转时间} = T_{完成时间} - T_{到达时间}
\]</div>
<p><ins class="critic">响应时间</ins> 从进程被创建(唤醒)到其首次获得CPU并开始执行的事件.</p>
<div class="arithmatex">\[
T_{响应时间} = T_{首次执行时间} - T_{到达时间}
\]</div>
<p><ins class="critic">响应比</ins> 作业等待时间+要求服务时间与要求服务时间</p>
<div class="arithmatex">\[
响应比 = \frac{作业等待时间+要求服务时间}{要求服务时间} = \frac{响应时间}{要求服务时间}
\]</div>
<h3 id="_10">调度算法<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h3>
<p><ins class="critic">先来先服务调度算法(FCFS\FIFO)</ins> 不管作业的时间长度,按照作业到达的顺序依次执行.</p>
<p><img alt="alt text" src="../images/%E5%85%88%E6%9D%A5%E5%85%88%E6%9C%8D%E5%8A%A1.png" /></p>
<p>先来先服务会出现<ins class="critic">护航效应</ins> 一些耗时较少的潜在资源消费,被安排在重量级资源消费之后. </p>
<p><img alt="alt text" src="../images/%E6%8A%A4%E8%88%AA%E6%95%88%E5%BA%94.png" /></p>
<p><ins class="critic">短作业优先(SJF)</ins> 作业\进程执行时间越短,优先级越高(默认非抢占式);在所有进程同步到达的情况下,该算法必定最优.</p>
<p><img alt="alt text" src="../images/SJF.png" /></p>
<p><ins class="critic">缺点</ins> </p>
<ul>
<li>可能导致长进程永远不执行</li>
<li>当作业先后到达的情况下,仍然存在护航效应的问题,</li>
</ul>
<p><img alt="alt text" src="../images/SJF1.png" /></p>
<p><ins class="critic">最短完成时间优先(STCF)</ins> 即抢占式SJF算法.</p>
<p><img alt="alt text" src="../images/%E6%8A%A2%E5%8D%A0%E5%BC%8FSJF%E7%AE%97%E6%B3%95.png" /> </p>
<p><ins class="critic">轮转(RR)调度算法</ins> 时间片轮转算法,保证进程的响应时间.</p>
<p><img alt="alt text" src="../images/RR%E8%B0%83%E5%BA%A6%E7%AE%97%E6%B3%95.png" /></p>
<ul>
<li>RR算法的响应时间较好,周转时间较差</li>
<li>当上下文切换的开销较大</li>
<li>公平调度算法</li>
</ul>
<p><ins class="critic">考虑I/O</ins> 采用重叠机制,在进程A需要I/O的时候调度程序调用其他进程(如B)上CPU执行. </p>
<p><img alt="alt text" src="../images/%E9%87%8D%E5%8F%A0.png" /></p>
<p><ins class="critic">多级反馈队列(MLFQ)</ins> </p>
<p>多级反馈队列中有许多独立的队列,每个队列<ins class="critic">具有不同的优先级</ins>. 任何时刻一个作业只能在一个队列内. MLFQ总是按照 <ins class="critic">优先级从高到低</ins> 执行工作. </p>
<ul>
<li>相同的队列内的作业,具有相同的优先级</li>
</ul>
<p><ins class="critic">MLFQ的基本规则</ins></p>
<ul>
<li>如果A的优先级 &gt; B的优先级, 则运行A而不运行B</li>
<li>如果A的优先级 = B的优先级,则轮转运行A\B(也可以按照先来先服务运行A,B)</li>
</ul>
<p><img alt="alt text" src="../images/MLFQ1.png" /></p>
<ul>
<li>工作进入系统时, 默认放在最高优先级. </li>
<li>一旦工作用完了在某一层的时间配额,则降低其优先级<ul>
<li>工作用完其时间片后,降低优先级</li>
<li>如果工作在其时间片内<ins class="critic">主动</ins>释放CPU则优先级不变.</li>
</ul>
</li>
<li>周期性提升(boost)所有工作的优先级<ul>
<li>每经过一段时间S,将所有工作重新加入最高优先级的队列</li>
<li>避免饥饿问题</li>
</ul>
</li>
</ul>
<p><img alt="alt text" src="../images/MLFQ2.png" /></p>
<p><ins class="critic">公平调度(比例份额)</ins> 确保每个工作都能获得一定比例的CPU时间.</p>
<ul>
<li>彩票调度 假设两个进程A和B分别有75张彩票和25张彩票(用彩票数假设期望A\B占用CPU的时间),调度程序每次<ins class="critic">随机</ins>从 0~99中抽取一个数,拥有这个数的进程将被允许调度.</li>
<li>步长调度 由于彩票调度需要一段时间后才能保证其分配给进程的时间按照预先设计的份额运行</li>
</ul>
<p>假设3个进程期待占用CPU的份额为 100, 50, 250, 步长调度算法通过一个大数(假如为1000)分别除以这些份额,得到3个进程的步长为(100,200,40),初始化ABC的行程为0,每次调度程序选择行程最小的进程执行,执行完后加上自身的步长,其调度过程如下所示.</p>
<p><img alt="alt text" src="../images/%E6%AD%A5%E9%95%BF%E8%B0%83%E5%BA%A6.png" /></p>
<ul>
<li>行程相等的时候<ins class="critic">随机</ins>选择一个进程执行</li>
</ul>
<h2 id="_11">死锁<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h2>
<p><ins class="critic">死锁</ins> 两个进程双方都希望对方能释放出自己所需要的资源,但它们都会因为不能获取自己所需要的资源去继续运行而无法释放自己当下的资源,并且一直处于这种僵持状态.</p>
<p><img alt="" src="../images/%E7%B3%BB%E7%BB%9F%E8%B5%84%E6%BA%90.png" /></p>
<p><ins class="critic">竞争不可抢占资源导致的死锁</ins> </p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">C</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span>
<span class="normal"><a href="#__codelineno-0-3">3</a></span>
<span class="normal"><a href="#__codelineno-0-4">4</a></span>
<span class="normal"><a href="#__codelineno-0-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="n">P1</span><span class="w">                              </span><span class="n">P2</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="p">....</span><span class="w">                            </span><span class="p">....</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="n">open</span><span class="p">(</span><span class="n">F1</span><span class="p">,</span><span class="w"> </span><span class="n">w</span><span class="p">);</span><span class="w">                    </span><span class="n">open</span><span class="p">(</span><span class="n">F2</span><span class="p">,</span><span class="n">w</span><span class="p">);</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="n">open</span><span class="p">(</span><span class="n">F2</span><span class="p">,</span><span class="w"> </span><span class="n">w</span><span class="p">);</span><span class="w">                    </span><span class="n">open</span><span class="p">(</span><span class="n">F1</span><span class="p">,</span><span class="n">w</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<p>上述并不一定会导致死锁,例如P1率先打开F1,F2,此时P2就会因为无法打开F2而导致阻塞;此时等待P1释放资源即可. </p>
<p>但上述也可能导致死锁,例如P1,P2先后执行一条open;此时P1打开F1,P2打开F2,此时P1希望P2释放F2,而P2希望P1释放F1,导致死锁. 可以用如下图所示的资源图描述.</p>
<p><img alt="" src="../images/%E6%AD%BB%E9%94%811.png" /></p>
<p><ins class="critic">竞争可消耗资源导致死锁</ins></p>
<p>考虑如下图所示的三个进程P1,P2,P3,采用消息通信机制进行通信.</p>
<p><img alt="alt text" src="../images/%E6%AD%BB%E9%94%812.png" /></p>
<p>假设三个进程按照先发送再接受的顺序通信,则不会发生死锁</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">C</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span>
<span class="normal"><a href="#__codelineno-1-2">2</a></span>
<span class="normal"><a href="#__codelineno-1-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="nl">P1</span><span class="p">:</span><span class="w"> </span><span class="p">...</span><span class="n">send</span><span class="p">(</span><span class="n">P2</span><span class="p">,</span><span class="w"> </span><span class="n">m1</span><span class="p">);</span><span class="w"> </span><span class="n">receive</span><span class="p">(</span><span class="n">P3</span><span class="p">,</span><span class="w"> </span><span class="n">m3</span><span class="p">);</span><span class="w"> </span><span class="p">...</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="nl">P2</span><span class="p">:</span><span class="w"> </span><span class="p">...</span><span class="n">send</span><span class="p">(</span><span class="n">P3</span><span class="p">,</span><span class="w"> </span><span class="n">m2</span><span class="p">);</span><span class="w"> </span><span class="n">receive</span><span class="p">(</span><span class="n">P1</span><span class="p">,</span><span class="w"> </span><span class="n">m1</span><span class="p">);</span><span class="w"> </span><span class="p">...</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="nl">P3</span><span class="p">:</span><span class="w"> </span><span class="p">...</span><span class="n">send</span><span class="p">(</span><span class="n">P1</span><span class="p">,</span><span class="w"> </span><span class="n">m3</span><span class="p">);</span><span class="w"> </span><span class="n">receive</span><span class="p">(</span><span class="n">P2</span><span class="p">,</span><span class="w"> </span><span class="n">m2</span><span class="p">);</span><span class="w"> </span><span class="p">...</span>
</code></pre></div></td></tr></table></div>
<p>但如果先接受消息再发生消息;则所有进程都会阻塞在receive操作上等待一个永远不会发出的消息产生死锁.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">C</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span>
<span class="normal"><a href="#__codelineno-2-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="nl">P1</span><span class="p">:</span><span class="w"> </span><span class="p">...</span><span class="n">receive</span><span class="p">(</span><span class="n">P3</span><span class="p">,</span><span class="w"> </span><span class="n">m3</span><span class="p">);</span><span class="n">send</span><span class="p">(</span><span class="n">P2</span><span class="p">,</span><span class="w"> </span><span class="n">m1</span><span class="p">);</span><span class="w"> </span><span class="p">...</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="nl">P2</span><span class="p">:</span><span class="w"> </span><span class="p">...</span><span class="n">receive</span><span class="p">(</span><span class="n">P1</span><span class="p">,</span><span class="w"> </span><span class="n">m1</span><span class="p">);</span><span class="n">send</span><span class="p">(</span><span class="n">P3</span><span class="p">,</span><span class="w"> </span><span class="n">m2</span><span class="p">);</span><span class="w"> </span><span class="p">...</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="nl">P3</span><span class="p">:</span><span class="w"> </span><span class="p">...</span><span class="n">receive</span><span class="p">(</span><span class="n">P2</span><span class="p">,</span><span class="w"> </span><span class="n">m2</span><span class="p">);</span><span class="n">send</span><span class="p">(</span><span class="n">P1</span><span class="p">,</span><span class="w"> </span><span class="n">m3</span><span class="p">);</span><span class="w"> </span><span class="p">...</span>
</code></pre></div></td></tr></table></div>
<p><ins class="critic">进程推进顺序不当引起死锁</ins></p>
<p><img alt="alt text" src="../images/%E6%AD%BB%E9%94%813.png" /></p>
<p><ins class="critic">产生死锁的必要条件</ins></p>
<ul>
<li>互斥条件 在一段时间内,某资源只能被一个进程占有.</li>
<li>请求和保持条件 进程已经占有了一个条件,但又提出了新的资源请求,而被请求的资源已被其他资源所占有,同时对其自身占有的资源保持不放</li>
<li>不可抢占条件 进程获得的资源在使用完之前不可以被剥夺</li>
<li>循环等待条件 必然存在一个进程-资源循环链,如上面所示的两个死锁情况</li>
</ul>
<p><ins class="critic">死锁的处理</ins> </p>
<ul>
<li><ins>预防死锁</ins> 破坏死锁的四个必要条件</li>
<li><ins>避免死锁</ins> 在资源分配的过程中,用某种方法防止系统进入不安全状态,从而避免发生死锁</li>
<li><ins>检测死锁\解除死锁</ins> 运行进程在运行过程中产生死锁,但发生死锁的时候系统要能检测到死锁的发生并能采取相应措施把进程从死锁中解脱出来<ul>
<li>常用办法有 <mark class="critic">资源剥夺法,撤销进程法,进程回退法</mark>.</li>
</ul>
</li>
</ul>
<h3 id="_12">死锁预防<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h3>
<p><ins class="critic">死锁预防</ins> 通过破防死锁的四个必要条件之一/几个来实现.(使用<ins class="critic">假脱机技术</ins>也可以预防死锁)</p>
<p><ins class="critic">破坏请求和保持条件</ins> 请求资源的时候该进程不可以持有不可抢占资源</p>
<ul>
<li>第一种协议 所有进程在开始的时候,一次性申请全部资源(破坏请求条件).若不满足则等待,直到所有资源都空闲(破坏保持条件)<ul>
<li>简单,易性,安全</li>
<li>资源浪费严重,进程容易发生饥饿现象</li>
</ul>
</li>
<li>第二种协议 允许一个进程只持有运行初期所需要的资源,在运行过程中逐步释放分配给自己的资源,当<ins class="critic">完全用完后</ins>再申请新的资源.(破坏保持条件)</li>
</ul>
<p><ins class="critic">破坏不可抢占条件</ins> 当一个进程已经保持了某些不可抢占资源而申请其他资源的时候,<ins class="critic">必须</ins>释放掉自己所持有的资源<ins class="critic">类似于被抢占</ins>,待以后需要的时候在申请.</p>
<ul>
<li>实现较为复杂,且代价较大.</li>
</ul>
<p><ins class="critic">破坏循环等待条件</ins> 对系统中所有资源类型进行线性排序,并赋予它们独一无二的序号.</p>
<ul>
<li>每个进程必须按照<ins class="critic">序号递增</ins>的顺序请求资源</li>
<li>如果需要多个同类资源,必须同时申请</li>
<li>假设某进程以获得了序列较高的资源,但想要申请低序号资源;则<ins class="critic">必须放弃所有相同获得高于</ins>该序号的资源</li>
</ul>
<h3 id="_13">死锁避免<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h3>
<p><ins class="critic">系统安全状态</ins>系统能按照某种推荐顺序 <span class="arithmatex">\(\{P_1,P_2,\ldots,P_n\}\)</span> 为每个进程 <span class="arithmatex">\(P_i\)</span> 分配器所需要的资源,直至满足每个进程对资源的最大需求,进而使每个进程都可以顺利完成的一种系统资源. </p>
<ul>
<li>此时 <span class="arithmatex">\(\{P_1,P_2,\ldots,P_n\}\)</span> 称为安全序列</li>
<li>如果无法找到任意一个安全序列,则此时状态为不安全状态</li>
<li>系统处于安全状态一定不会导致死锁;处于不安全状态<ins class="critic">可能</ins>导致死锁</li>
</ul>
<div class="admonition example">
<p class="admonition-title">安全状态举例</p>
<p><img alt="alt text" src="../images/%E5%AE%89%E5%85%A8%E7%8A%B6%E6%80%81%E4%B8%BE%E4%BE%8B.png" /></p>
</div>
<p><ins class="critic">死锁避免</ins> 在分配资源前,OS判断将资源分配给进程后系统是否仍然处于安全状态,若处于则分配;否则不分配.</p>
<p><ins class="critic">银行家算法</ins> Dijkstra设计</p>
<p><img alt="" src="../images/%E9%93%B6%E8%A1%8C%E5%AE%B6%E7%AE%97%E6%B3%95.png" /></p>
<div class="admonition example">
<p class="admonition-title">银行家算法</p>
<p><img alt="alt text" src="../images/%E9%93%B6%E8%A1%8C%E5%AE%B6%E7%AE%97%E6%B3%951.png" />
<img alt="alt text" src="../images/%E9%93%B6%E8%A1%8C%E5%AE%B6%E7%AE%97%E6%B3%952.png" /></p>
</div>
<h3 id="_14">死锁的检测与解除<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h3>
<p><ins class="critic">资源图的简化流程</ins></p>
<p><img alt="alt text" src="../images/%E8%B5%84%E6%BA%90%E5%9B%BE%E7%9A%84%E7%AE%80%E5%8C%96.png" /></p>
<ul>
<li>在资源图中找到一个<ins class="critic">即不阻塞也不孤立</ins>的进程 <span class="arithmatex">\(P_i\)</span></li>
<li>消去 <span class="arithmatex">\(P_i\)</span> 的请求边和分配边,使之成为孤立点<ul>
<li>例如上述中P1进程,其持有2个R1资源请求1个R2资源</li>
<li>而系统一共有3个R1资源,1个R2资源(被P2持有了一个).均大于等于P1的请求\持有量</li>
<li>则P1必然可以完成执行并释放其占有的资源,故可以移去其的所有入边和出边</li>
</ul>
</li>
<li>重复这个过程<ul>
<li>若所有结点最终都是孤立点,则该资源图式可完全简化</li>
<li>否则为不可完全简化图</li>
</ul>
</li>
</ul>
<p><ins class="critic">死锁定理</ins> 所有的简化顺序,都将得到相同的不可完全简化图.当且仅当S状态的资源分配图是不可完全简化的,此时状态S为必然发生了死锁.</p>
<p><ins class="critic">死锁的解除</ins> <mark class="critic">资源剥夺法,撤销进程法,进程回退法</mark>.</p>
<h2 id="_15">进程同步<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h2>
<p><ins class="critic">进程同步</ins> 在异步环境下的一组因直接制约而相互发送消息,互相合作,互相等待,使得个进程按一定速度执行的过程.</p>
<p>具有同步关系的一组进程被称为 <ins class="critic">协作进程</ins></p>
<p><ins class="critic">互斥关系</ins> 对于不可抢占资源(即临界区)的共享,会导致进程和进程之间产生互斥关系,是一种间接制约关系.</p>
<p><ins class="critic">同步关系</ins> 多个进程（或线程）为了完成某个共同任务，需要按照一定的顺序或时序执行，即一个进程的执行依赖于另一个进程的某个事件或状态, 是一种直接制约关系.</p>
<p><ins class="critic">临界资源(临界区)</ins> 每个进程访问临界资源的那段代码称为临界区.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">C</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span>
<span class="normal"><a href="#__codelineno-3-3">3</a></span>
<span class="normal"><a href="#__codelineno-3-4">4</a></span>
<span class="normal"><a href="#__codelineno-3-5">5</a></span>
<span class="normal"><a href="#__codelineno-3-6">6</a></span>
<span class="normal"><a href="#__codelineno-3-7">7</a></span>
<span class="normal"><a href="#__codelineno-3-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="k">while</span><span class="p">(</span><span class="n">TRUE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="w">    </span><span class="err">\\</span><span class="w"> </span><span class="n">进入区代码</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="w">    </span><span class="p">....</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="w">    </span><span class="err">\\</span><span class="w"> </span><span class="n">临界区代码</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="w">    </span><span class="p">....</span>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="w">    </span><span class="err">\\</span><span class="w"> </span><span class="n">退出去代码</span>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="w">    </span><span class="p">....</span>
<a id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_16">软件同步机制<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h3>
<p>解决临界区问题的四大准则</p>
<ul>
<li>空闲让进 当无进程访问临界区的时候,应该允许一个进程访问临界资源</li>
<li>忙则等待 当已有进程访问临界区的时候,应阻止其他进程访问临界资源</li>
<li>有限等待 对于要求访问临界区的进程,其等待时间应该是有限度的</li>
<li>让权等待 当进程不能进入自己的临界区的时候,应该立即释放处理机.(原则上应该遵循)</li>
</ul>
<p><ins class="critic">Peterson解决方案</ins></p>
<p>问题描述: 有两个交替运行的进程Pi和Pj,要求两个进程共享两个变量 <code>int turn</code> 和 <code>boolean flag[2]</code>, 变量<code>turn</code> 表示那个进程可以进入临界区, 数组flag表示那个进程准备进入临界区.</p>
<p>进程Pi的结构</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span>
<span class="normal"><a href="#__codelineno-4-2">2</a></span>
<span class="normal"><a href="#__codelineno-4-3">3</a></span>
<span class="normal"><a href="#__codelineno-4-4">4</a></span>
<span class="normal"><a href="#__codelineno-4-5">5</a></span>
<span class="normal"><a href="#__codelineno-4-6">6</a></span>
<span class="normal"><a href="#__codelineno-4-7">7</a></span>
<span class="normal"><a href="#__codelineno-4-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="k">do</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="w">    </span><span class="n">flag</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="w">    </span><span class="n">turn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="p">;</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">flag</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">turn</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">j</span><span class="p">);</span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="w">    </span><span class="c1">// 临界区</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="w">    </span><span class="n">flag</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="w">    </span><span class="c1">// ....</span>
<a id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<p>Pj的结构也是类似的, 可以发现Peterson解决办法的本质是一种谦让算法. 在Pi进程中设置 <code>turn=j</code>把临界区让给Pj进程,而让自己进入忙等状态;最终谁可以获取临界区完全由<code>turn=?</code>来决定.</p>
<h3 id="_17">硬件同步机制<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h3>
<p><ins class="critic">关中断</ins> 在进入锁检测的时候关闭时钟中断,检测完成后并上锁后再重启中断. </p>
<p>但关中断的坏处也是很多的,一般不采用.</p>
<p><ins class="critic">利用Test-and-Set</ins> 用于检测进程是否持有锁</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span>
<span class="normal"><a href="#__codelineno-5-2">2</a></span>
<span class="normal"><a href="#__codelineno-5-3">3</a></span>
<span class="normal"><a href="#__codelineno-5-4">4</a></span>
<span class="normal"><a href="#__codelineno-5-5">5</a></span>
<span class="normal"><a href="#__codelineno-5-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="n">boolean</span><span class="w"> </span><span class="nf">TS</span><span class="p">(</span><span class="n">boolean</span><span class="w"> </span><span class="o">*</span><span class="n">lock</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="w">    </span><span class="n">boolean</span><span class="w"> </span><span class="n">old</span><span class="p">;</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="w">    </span><span class="n">old</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">lock</span><span class="p">;</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="w">    </span><span class="o">*</span><span class="n">lock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TRUE</span><span class="p">;</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">old</span><span class="p">;</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>主要硬件实现的TS是一个原语(原子操作)不可分割,不会被中断,功能类似于上述的函数.</p>
<p>此时进程的结构类似于</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span>
<span class="normal"><a href="#__codelineno-6-2">2</a></span>
<span class="normal"><a href="#__codelineno-6-3">3</a></span>
<span class="normal"><a href="#__codelineno-6-4">4</a></span>
<span class="normal"><a href="#__codelineno-6-5">5</a></span>
<span class="normal"><a href="#__codelineno-6-6">6</a></span>
<span class="normal"><a href="#__codelineno-6-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="k">do</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="w">    </span><span class="err">\\</span><span class="w"> </span><span class="p">....</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="n">TS</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock</span><span class="p">);</span><span class="w"> </span><span class="c1">// do skip</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="w">    </span><span class="n">critical</span><span class="w"> </span><span class="n">section</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="c1">// 临界区</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="w">    </span><span class="n">lock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="w">    </span><span class="n">remainder</span><span class="w"> </span><span class="n">section</span><span class="p">;</span>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<p><ins class="critic">利用swap</ins> 原子的用于交换两个区域的内容</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span>
<span class="normal"><a href="#__codelineno-7-2">2</a></span>
<span class="normal"><a href="#__codelineno-7-3">3</a></span>
<span class="normal"><a href="#__codelineno-7-4">4</a></span>
<span class="normal"><a href="#__codelineno-7-5">5</a></span>
<span class="normal"><a href="#__codelineno-7-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">swap</span><span class="p">(</span><span class="n">boolean</span><span class="w"> </span><span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">boolean</span><span class="w"> </span><span class="o">*</span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="w">    </span><span class="n">boolean</span><span class="w"> </span><span class="n">temp</span><span class="p">;</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="w">    </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">a</span><span class="p">;</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="w">    </span><span class="o">*</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">b</span><span class="p">;</span>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="w">    </span><span class="o">*</span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="p">;</span>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>采用swap的进程描述如下 </p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span>
<span class="normal"><a href="#__codelineno-8-2">2</a></span>
<span class="normal"><a href="#__codelineno-8-3">3</a></span>
<span class="normal"><a href="#__codelineno-8-4">4</a></span>
<span class="normal"><a href="#__codelineno-8-5">5</a></span>
<span class="normal"><a href="#__codelineno-8-6">6</a></span>
<span class="normal"><a href="#__codelineno-8-7">7</a></span>
<span class="normal"><a href="#__codelineno-8-8">8</a></span>
<span class="normal"><a href="#__codelineno-8-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="k">do</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="w">    </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="w">    </span><span class="k">do</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="w">        </span><span class="n">swap</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">key</span><span class="p">);</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="p">(</span><span class="n">key</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="w">    </span><span class="c1">// 临界区</span>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="w">    </span><span class="n">lock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="w">    </span><span class="c1">// ....</span>
<a id="__codelineno-8-9" name="__codelineno-8-9"></a><span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<p>需要注意的是上述的软件实现和硬件实现<del class="critic">均无法实现让权等待</del>,在无法获得锁的情况下,均会进入忙等.</p>
<h3 id="_18">信号量机制<a class="headerlink" href="#_18" title="Permanent link">&para;</a></h3>
<p><ins class="critic">整型信号量</ins> 定义为表示资源数目的类型量S,除初始化外<ins class="critic">仅能</ins>通过两个标准的原子操作 <ins class="critic">wait(S)和signal(S)</ins>来访问.</p>
<p>其操作可以描述为如下,但要注意它们都是原子操作.
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span>
<span class="normal"><a href="#__codelineno-9-2">2</a></span>
<span class="normal"><a href="#__codelineno-9-3">3</a></span>
<span class="normal"><a href="#__codelineno-9-4">4</a></span>
<span class="normal"><a href="#__codelineno-9-5">5</a></span>
<span class="normal"><a href="#__codelineno-9-6">6</a></span>
<span class="normal"><a href="#__codelineno-9-7">7</a></span>
<span class="normal"><a href="#__codelineno-9-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="n">wait</span><span class="p">(</span><span class="n">S</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">S</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="c1">// do no-op</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="w">    </span><span class="n">S</span><span class="o">--</span><span class="p">;</span>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="p">}</span>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a>
<a id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="n">signal</span><span class="p">(</span><span class="n">S</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="w">    </span><span class="n">S</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-9-8" name="__codelineno-9-8"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
需要注意采用整型信号量,仍然无法满足让权等待的要求. 当S不足的时候, wait操作会自旋等待而非交去处理机.</p>
<p><ins class="critic">记录型信号量</ins> 通过增加一个进程链表指针list来链接所有因为wait操作被阻塞的进程. 从而可以通过signal操作唤醒那些进程.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-10-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-10-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-10-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-10-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-10-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-10-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-10-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-10-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-10-10">10</a></span>
<span class="normal"><a href="#__codelineno-10-11">11</a></span>
<span class="normal"><a href="#__codelineno-10-12">12</a></span>
<span class="normal"><a href="#__codelineno-10-13">13</a></span>
<span class="normal"><a href="#__codelineno-10-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">;</span><span class="w"> </span><span class="c1">// 系统中的资源数目</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">process_control_block</span><span class="w"> </span><span class="o">*</span><span class="n">list</span><span class="p">;</span><span class="w">  </span><span class="c1">// 进程链表</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="p">}</span><span class="n">semaphore</span><span class="p">;</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="n">wait</span><span class="p">(</span><span class="n">semaphore</span><span class="w"> </span><span class="o">*</span><span class="n">S</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="w">    </span><span class="n">S</span><span class="o">-&gt;</span><span class="n">value</span><span class="o">--</span><span class="p">;</span>
<a id="__codelineno-10-8" name="__codelineno-10-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">S</span><span class="o">-&gt;</span><span class="n">value</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">block</span><span class="p">(</span><span class="n">S</span><span class="o">-&gt;</span><span class="n">list</span><span class="p">);</span>
<a id="__codelineno-10-9" name="__codelineno-10-9"></a><span class="p">}</span>
<a id="__codelineno-10-10" name="__codelineno-10-10"></a>
<a id="__codelineno-10-11" name="__codelineno-10-11"></a><span class="n">signal</span><span class="p">(</span><span class="n">semaphore</span><span class="w"> </span><span class="o">*</span><span class="n">S</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-12" name="__codelineno-10-12"></a><span class="w">    </span><span class="n">S</span><span class="o">-&gt;</span><span class="n">value</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-10-13" name="__codelineno-10-13"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">S</span><span class="o">-&gt;</span><span class="n">value</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">wakeup</span><span class="p">(</span><span class="n">S</span><span class="o">-&gt;</span><span class="n">list</span><span class="p">);</span>
<a id="__codelineno-10-14" name="__codelineno-10-14"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><ins class="critic">AND型信号量</ins> 针对一个进程需要共享两个或更多共享资源的解决方案;将进程在整个运行过程中所需要的资源<ins class="critic">一次性</ins>全部分配给进程,待进程用完后再<ins class="critic">一次性释放</ins></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-11-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-11-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-11-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-11-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-11-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-11-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-11-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-11-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-11-10">10</a></span>
<span class="normal"><a href="#__codelineno-11-11">11</a></span>
<span class="normal"><a href="#__codelineno-11-12">12</a></span>
<span class="normal"><a href="#__codelineno-11-13">13</a></span>
<span class="normal"><a href="#__codelineno-11-14">14</a></span>
<span class="normal"><a href="#__codelineno-11-15">15</a></span>
<span class="normal"><a href="#__codelineno-11-16">16</a></span>
<span class="normal"><a href="#__codelineno-11-17">17</a></span>
<span class="normal"><a href="#__codelineno-11-18">18</a></span>
<span class="normal"><a href="#__codelineno-11-19">19</a></span>
<span class="normal"><a href="#__codelineno-11-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="n">S_wait</span><span class="p">(</span><span class="n">S1</span><span class="p">,</span><span class="w"> </span><span class="n">S2</span><span class="p">,</span><span class="w"> </span><span class="p">...,</span><span class="w"> </span><span class="n">Sn</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nb">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">S1</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">S2</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">....</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Sn</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">Si</span><span class="o">--</span><span class="p">;</span>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="w">            </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="w">            </span><span class="c1">// 将进程放入与第一个Si &lt; 1的Si相关联的等待队列中，并将该进程的程序计数器设置为S_wait操作的起始位置。</span>
<a id="__codelineno-11-9" name="__codelineno-11-9"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-11-10" name="__codelineno-11-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-11-11" name="__codelineno-11-11"></a><span class="p">}</span>
<a id="__codelineno-11-12" name="__codelineno-11-12"></a>
<a id="__codelineno-11-13" name="__codelineno-11-13"></a><span class="n">S_signal</span><span class="p">(</span><span class="n">S1</span><span class="p">,</span><span class="n">S2</span><span class="p">,...,</span><span class="n">Sn</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-14" name="__codelineno-11-14"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nb">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-15" name="__codelineno-11-15"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-16" name="__codelineno-11-16"></a><span class="w">            </span><span class="n">Si</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-11-17" name="__codelineno-11-17"></a><span class="w">            </span><span class="c1">// 移除所有和Si的等待队列中的进程,将这些进程加入就绪队列</span>
<a id="__codelineno-11-18" name="__codelineno-11-18"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-11-19" name="__codelineno-11-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-11-20" name="__codelineno-11-20"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><ins class="critic">信号量集</ins> 运行一次wait操作或者signal 获取/释放 多个临界区资源,采用的是AND信号量</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span>
<span class="normal"><a href="#__codelineno-12-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="n">S_wait</span><span class="p">(</span><span class="n">S1</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">d1</span><span class="p">;</span><span class="n">S2</span><span class="p">,</span><span class="n">t2</span><span class="p">,</span><span class="n">d2</span><span class="p">;...;</span><span class="n">Sn</span><span class="p">,</span><span class="n">tn</span><span class="p">,</span><span class="n">dn</span><span class="p">);</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="n">S_signal</span><span class="p">(</span><span class="n">S1</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">d1</span><span class="p">;</span><span class="n">S2</span><span class="p">,</span><span class="n">t2</span><span class="p">,</span><span class="n">d2</span><span class="p">;...;</span><span class="n">Sn</span><span class="p">,</span><span class="n">tn</span><span class="p">,</span><span class="n">dn</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>S_wait(S,t,d)</code> 系统运行分配的下限为t,需求值d;若需求值小于下限不予分配,资源不足d时也不予分配</li>
<li><code>S_wait(S,1,1)</code> 退化为互斥信号量(S=1)或者一般记录信号量(S&gt;1)</li>
<li><code>S_wait(S, 1, 0)</code> 当S&gt;=1的时候表明运行多个进程进入特定的临界区,而S=0,则阻止任何进程进入临界区.</li>
</ul>
<p><ins class="critic">信号量的应用</ins></p>
<p>实现互斥操作, 设置信号量<code>mutex</code>其取值范围为 <span class="arithmatex">\((-1,0,1)\)</span></p>
<ul>
<li><code>mutex = 1</code> 两进程均为进入临界区,任意一个进程均可以获取锁并进入临界区</li>
<li><code>mutex = 0</code> 表示另外进程已经持有了互斥锁,此时申请进入临界区的进程必须阻塞自我等待</li>
<li><code>mutex = -1</code> 表示有一个进程在临界区内执行,且另一个进程在阻塞队列等待唤醒</li>
</ul>
<p><div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-13-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-13-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-13-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-13-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-13-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-13-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-13-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-13-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-13-10">10</a></span>
<span class="normal"><a href="#__codelineno-13-11">11</a></span>
<span class="normal"><a href="#__codelineno-13-12">12</a></span>
<span class="normal"><a href="#__codelineno-13-13">13</a></span>
<span class="normal"><a href="#__codelineno-13-14">14</a></span>
<span class="normal"><a href="#__codelineno-13-15">15</a></span>
<span class="normal"><a href="#__codelineno-13-16">16</a></span>
<span class="normal"><a href="#__codelineno-13-17">17</a></span>
<span class="normal"><a href="#__codelineno-13-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="n">semaphore</span><span class="w"> </span><span class="n">mutex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="n">PA</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="w">        </span><span class="n">wait</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="w">        </span><span class="c1">// 临界区;</span>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="w">        </span><span class="n">signal</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="w">        </span><span class="c1">// 剩余内容</span>
<a id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-13-9" name="__codelineno-13-9"></a><span class="p">}</span>
<a id="__codelineno-13-10" name="__codelineno-13-10"></a>
<a id="__codelineno-13-11" name="__codelineno-13-11"></a><span class="n">PB</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-12" name="__codelineno-13-12"></a><span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-13" name="__codelineno-13-13"></a><span class="w">        </span><span class="n">wait</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span>
<a id="__codelineno-13-14" name="__codelineno-13-14"></a><span class="w">        </span><span class="c1">// 临界区</span>
<a id="__codelineno-13-15" name="__codelineno-13-15"></a><span class="w">        </span><span class="n">signal</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span>
<a id="__codelineno-13-16" name="__codelineno-13-16"></a><span class="w">        </span><span class="c1">// 剩余内容</span>
<a id="__codelineno-13-17" name="__codelineno-13-17"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-13-18" name="__codelineno-13-18"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
互斥的实现比较简单,需要注意wait()操作和signal()操作必须<ins class="critic">成对出现</ins></p>
<p><ins class="critic">利用信号量实现同步操作</ins></p>
<p>假设进程P1和P2中有两段代码C1和C2,现要求C1必须在C2之前执行. 设一个同步型信号量S,设置其<ins class="critic">初始值为0</ins>,区别于互斥型型号量.其取值范围也为 <span class="arithmatex">\((-1,0,1)\)</span></p>
<ul>
<li><code>S=0</code> 表示C1尚未执行,C2也不允许执行</li>
<li><code>S=1</code> 表示C1已经执行,此时C2运行执行</li>
<li><code>S=-1</code> 表示C2想执行,但C1尚未执行,不允许C2执行.</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-14-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-14-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-14-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-14-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-14-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-14-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-14-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-14-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-14-10">10</a></span>
<span class="normal"><a href="#__codelineno-14-11">11</a></span>
<span class="normal"><a href="#__codelineno-14-12">12</a></span>
<span class="normal"><a href="#__codelineno-14-13">13</a></span>
<span class="normal"><a href="#__codelineno-14-14">14</a></span>
<span class="normal"><a href="#__codelineno-14-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="n">semaphore</span><span class="w"> </span><span class="n">S</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="n">P1</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="w">        </span><span class="err">\\</span><span class="w"> </span><span class="n">C1代码段</span>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="w">        </span><span class="n">signal</span><span class="p">(</span><span class="n">S</span><span class="p">);</span>
<a id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-14-8" name="__codelineno-14-8"></a><span class="p">}</span>
<a id="__codelineno-14-9" name="__codelineno-14-9"></a>
<a id="__codelineno-14-10" name="__codelineno-14-10"></a><span class="n">P2</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-11" name="__codelineno-14-11"></a><span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-12" name="__codelineno-14-12"></a><span class="w">        </span><span class="n">wait</span><span class="p">(</span><span class="n">S</span><span class="p">);</span>
<a id="__codelineno-14-13" name="__codelineno-14-13"></a><span class="w">        </span><span class="err">\\</span><span class="w"> </span><span class="n">C2代码段</span>
<a id="__codelineno-14-14" name="__codelineno-14-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-14-15" name="__codelineno-14-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>通过在<ins class="critic">不同</ins>进程内设置一对同步信号量来达成同步的要求.</p>
<h3 id="_19">管程机制<a class="headerlink" href="#_19" title="Permanent link">&para;</a></h3>
<p><ins class="critic">管程</ins> 一个数据结构能被并发进程(在该数据结构上)所执行的一组操作,这组操作能同步进程和改变管程中的数据.</p>
<p><img alt="alt text" src="../images/%E7%AE%A1%E7%A8%8B.png" /></p>
<ul>
<li>管程的名字</li>
<li><ins class="critic">局限于</ins>管程内的共享数据结构</li>
<li>对该数据结构的一组操作过程</li>
<li><ins class="critic">局限于</ins>管程内的共享数据初值的语句</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-15-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-15-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-15-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-15-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-15-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-15-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-15-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-15-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-15-10">10</a></span>
<span class="normal"><a href="#__codelineno-15-11">11</a></span>
<span class="normal"><a href="#__codelineno-15-12">12</a></span>
<span class="normal"><a href="#__codelineno-15-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="n">monitor</span><span class="w"> </span><span class="n">monitor_name</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// 管程名</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="w">    </span><span class="n">share</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">declarations</span><span class="p">;</span><span class="w"> </span><span class="c1">// 共享变量的说明</span>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="w">    </span><span class="n">cond</span><span class="w"> </span><span class="n">declarations</span><span class="p">;</span><span class="w"> </span><span class="c1">// 条件变量的说明</span>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="w">    </span><span class="k">public</span><span class="o">:</span><span class="w"> </span><span class="c1">// 能被进程调用的过程</span>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">P1</span><span class="p">(......)</span><span class="w"> </span><span class="p">{....}</span><span class="w"> </span>
<a id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">P2</span><span class="p">(......)</span><span class="w"> </span><span class="p">{....}</span>
<a id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="w">    </span><span class="p">.....</span>
<a id="__codelineno-15-8" name="__codelineno-15-8"></a>
<a id="__codelineno-15-9" name="__codelineno-15-9"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="c1">// 管程主体</span>
<a id="__codelineno-15-10" name="__codelineno-15-10"></a><span class="w">    </span><span class="n">initialization</span><span class="w"> </span><span class="n">code</span><span class="p">;</span><span class="w"> </span><span class="c1">// 初始化代码</span>
<a id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="w">    </span><span class="p">.....</span>
<a id="__codelineno-15-12" name="__codelineno-15-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-15-13" name="__codelineno-15-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><ins class="critic">条件变量</ins> 多个进程访问管程可以由于不同的原因导致阻塞\挂起,若不释放管程则会导致其他想要进入管程的进程被阻塞,通过设置条件变量来控制. 条件变量仅有两种操作 {wait和signal}. 其含义如下</p>
<ul>
<li>x.wait 当前调用管程的进程因为条件x而进入阻塞,将自己挂载x的条件队列内</li>
<li>x.signal 调用管程的进程发现x条件发生了改变,唤醒因x而被挂起的进程<ul>
<li>若没有因x而挂起的进程,则接着执行当前进程</li>
<li>若有多个,则选择某一个<ul>
<li>此时是执行选择的这一个还是原进程目前并不定论</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="_20">经典同步问题<a class="headerlink" href="#_20" title="Permanent link">&para;</a></h3>
<h4 id="-">生产者-消费者问题<a class="headerlink" href="#-" title="Permanent link">&para;</a></h4>
<p><ins>问题描述</ins> 假设有1个或多个生产者线程和一个或多个消费者线程.生产者将生成的数据项加入缓冲区;消费者从缓冲区取走数据.要求生产者不能往满的缓冲区内加入数据,消费者不能从空的缓冲区内取走数据.</p>
<p><ins class="critic">利用记录型信号量</ins> 假设所有生产者\消费者等价,即任何消费者可以去任何生产者生产的数据,只要缓冲区非空.</p>
<ul>
<li><code>mutex</code> 互斥型信号量 限制进制互斥访问缓冲区</li>
<li><code>full\empty</code> 记录型信号量 表面缓冲区内的元素数量</li>
<li>考研大概率只需要掌握这一种方法就可以</li>
</ul>
<p>则此时解决方案如下所示</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-16-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-16-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-16-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-16-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-16-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-16-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-16-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-16-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-16-10">10</a></span>
<span class="normal"><a href="#__codelineno-16-11">11</a></span>
<span class="normal"><a href="#__codelineno-16-12">12</a></span>
<span class="normal"><a href="#__codelineno-16-13">13</a></span>
<span class="normal"><a href="#__codelineno-16-14">14</a></span>
<span class="normal"><a href="#__codelineno-16-15">15</a></span>
<span class="normal"><a href="#__codelineno-16-16">16</a></span>
<span class="normal"><a href="#__codelineno-16-17">17</a></span>
<span class="normal"><a href="#__codelineno-16-18">18</a></span>
<span class="normal"><a href="#__codelineno-16-19">19</a></span>
<span class="normal"><a href="#__codelineno-16-20">20</a></span>
<span class="normal"><a href="#__codelineno-16-21">21</a></span>
<span class="normal"><a href="#__codelineno-16-22">22</a></span>
<span class="normal"><a href="#__codelineno-16-23">23</a></span>
<span class="normal"><a href="#__codelineno-16-24">24</a></span>
<span class="normal"><a href="#__codelineno-16-25">25</a></span>
<span class="normal"><a href="#__codelineno-16-26">26</a></span>
<span class="normal"><a href="#__codelineno-16-27">27</a></span>
<span class="normal"><a href="#__codelineno-16-28">28</a></span>
<span class="normal"><a href="#__codelineno-16-29">29</a></span>
<span class="normal"><a href="#__codelineno-16-30">30</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="n">item</span><span class="w"> </span><span class="n">buffer</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="n">semaphore</span><span class="w"> </span><span class="n">mutex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">empty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">full</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a>
<a id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="c1">// 生产者线程</span>
<a id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="kt">void</span><span class="w"> </span><span class="nf">producer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-8" name="__codelineno-16-8"></a><span class="w">    </span><span class="k">do</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-9" name="__codelineno-16-9"></a><span class="w">         </span><span class="c1">// produce an item next_p;</span>
<a id="__codelineno-16-10" name="__codelineno-16-10"></a><span class="w">        </span><span class="n">wait</span><span class="p">(</span><span class="n">empty</span><span class="p">);</span>
<a id="__codelineno-16-11" name="__codelineno-16-11"></a><span class="w">        </span><span class="n">wait</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span>
<a id="__codelineno-16-12" name="__codelineno-16-12"></a><span class="w">        </span><span class="n">buffer</span><span class="p">[</span><span class="n">in</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_p</span><span class="p">;</span>
<a id="__codelineno-16-13" name="__codelineno-16-13"></a><span class="w">        </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">in</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="n">n</span><span class="p">;</span>
<a id="__codelineno-16-14" name="__codelineno-16-14"></a><span class="w">        </span><span class="n">signal</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span><span class="w"> </span><span class="c1">// 互斥夹紧</span>
<a id="__codelineno-16-15" name="__codelineno-16-15"></a><span class="w">        </span><span class="n">signal</span><span class="p">(</span><span class="n">full</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-16-16" name="__codelineno-16-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-16-17" name="__codelineno-16-17"></a><span class="p">}</span>
<a id="__codelineno-16-18" name="__codelineno-16-18"></a>
<a id="__codelineno-16-19" name="__codelineno-16-19"></a><span class="c1">// 消费者进程</span>
<a id="__codelineno-16-20" name="__codelineno-16-20"></a><span class="kt">void</span><span class="w"> </span><span class="nf">consumer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-21" name="__codelineno-16-21"></a><span class="w">    </span><span class="k">do</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-22" name="__codelineno-16-22"></a><span class="w">        </span><span class="n">wait</span><span class="p">(</span><span class="n">full</span><span class="p">);</span>
<a id="__codelineno-16-23" name="__codelineno-16-23"></a><span class="w">        </span><span class="n">wait</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span>
<a id="__codelineno-16-24" name="__codelineno-16-24"></a><span class="w">        </span><span class="n">next_c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer</span><span class="p">[</span><span class="n">out</span><span class="p">];</span>
<a id="__codelineno-16-25" name="__codelineno-16-25"></a><span class="w">        </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
<a id="__codelineno-16-26" name="__codelineno-16-26"></a><span class="w">        </span><span class="n">signal</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span><span class="w"> </span><span class="c1">// 互斥夹紧</span>
<a id="__codelineno-16-27" name="__codelineno-16-27"></a><span class="w">        </span><span class="n">signal</span><span class="p">(</span><span class="n">empty</span><span class="p">);</span>
<a id="__codelineno-16-28" name="__codelineno-16-28"></a><span class="w">        </span><span class="c1">// consume the item in next_c;</span>
<a id="__codelineno-16-29" name="__codelineno-16-29"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-16-30" name="__codelineno-16-30"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>注意wait操作不可以颠倒,否则会死锁<ul>
<li>必须先获得了资源在申请进入临界区</li>
</ul>
</li>
<li>互斥变量的wait和signal必须成对出现且相邻(互斥夹紧)</li>
<li>信号量full和empty也必须成对出现,但出现在不同线程中</li>
</ul>
<p><ins class="critic">利用AND信号量</ins> 使用S_wait和S_signal来替代连续的多个wait和signal操作</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-17-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-17-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-17-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-17-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-17-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-17-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-17-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-17-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-17-10">10</a></span>
<span class="normal"><a href="#__codelineno-17-11">11</a></span>
<span class="normal"><a href="#__codelineno-17-12">12</a></span>
<span class="normal"><a href="#__codelineno-17-13">13</a></span>
<span class="normal"><a href="#__codelineno-17-14">14</a></span>
<span class="normal"><a href="#__codelineno-17-15">15</a></span>
<span class="normal"><a href="#__codelineno-17-16">16</a></span>
<span class="normal"><a href="#__codelineno-17-17">17</a></span>
<span class="normal"><a href="#__codelineno-17-18">18</a></span>
<span class="normal"><a href="#__codelineno-17-19">19</a></span>
<span class="normal"><a href="#__codelineno-17-20">20</a></span>
<span class="normal"><a href="#__codelineno-17-21">21</a></span>
<span class="normal"><a href="#__codelineno-17-22">22</a></span>
<span class="normal"><a href="#__codelineno-17-23">23</a></span>
<span class="normal"><a href="#__codelineno-17-24">24</a></span>
<span class="normal"><a href="#__codelineno-17-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="n">item</span><span class="w"> </span><span class="n">buffer</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="n">semaphore</span><span class="w"> </span><span class="n">mutex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">empty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">full</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a>
<a id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="c1">// 生产者线程</span>
<a id="__codelineno-17-6" name="__codelineno-17-6"></a><span class="kt">void</span><span class="w"> </span><span class="nf">producer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-7" name="__codelineno-17-7"></a><span class="w">    </span><span class="k">do</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-8" name="__codelineno-17-8"></a><span class="w">         </span><span class="c1">// produce an item next_p;</span>
<a id="__codelineno-17-9" name="__codelineno-17-9"></a><span class="w">        </span><span class="n">S_wait</span><span class="p">(</span><span class="n">empty</span><span class="p">,</span><span class="w"> </span><span class="n">mutex</span><span class="p">)</span>
<a id="__codelineno-17-10" name="__codelineno-17-10"></a><span class="w">        </span><span class="n">buffer</span><span class="p">[</span><span class="n">in</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_p</span><span class="p">;</span>
<a id="__codelineno-17-11" name="__codelineno-17-11"></a><span class="w">        </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">in</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="n">n</span><span class="p">;</span>
<a id="__codelineno-17-12" name="__codelineno-17-12"></a><span class="w">        </span><span class="n">S_signal</span><span class="p">(</span><span class="n">mutex</span><span class="p">,</span><span class="w"> </span><span class="n">full</span><span class="p">);</span>
<a id="__codelineno-17-13" name="__codelineno-17-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-17-14" name="__codelineno-17-14"></a><span class="p">}</span>
<a id="__codelineno-17-15" name="__codelineno-17-15"></a>
<a id="__codelineno-17-16" name="__codelineno-17-16"></a><span class="c1">// 消费者进程</span>
<a id="__codelineno-17-17" name="__codelineno-17-17"></a><span class="kt">void</span><span class="w"> </span><span class="nf">consumer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-18" name="__codelineno-17-18"></a><span class="w">    </span><span class="k">do</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-19" name="__codelineno-17-19"></a><span class="w">        </span><span class="n">S_wait</span><span class="p">(</span><span class="n">full</span><span class="p">,</span><span class="w"> </span><span class="n">mutex</span><span class="p">);</span>
<a id="__codelineno-17-20" name="__codelineno-17-20"></a><span class="w">        </span><span class="n">next_c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer</span><span class="p">[</span><span class="n">out</span><span class="p">];</span>
<a id="__codelineno-17-21" name="__codelineno-17-21"></a><span class="w">        </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
<a id="__codelineno-17-22" name="__codelineno-17-22"></a><span class="w">        </span><span class="n">S_signal</span><span class="p">(</span><span class="n">mutex</span><span class="p">,</span><span class="w"> </span><span class="n">empty</span><span class="p">);</span>
<a id="__codelineno-17-23" name="__codelineno-17-23"></a><span class="w">        </span><span class="c1">// consume the item in next_c;</span>
<a id="__codelineno-17-24" name="__codelineno-17-24"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-17-25" name="__codelineno-17-25"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><ins class="critic">利用管程</ins></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-18-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-18-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-18-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-18-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-18-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-18-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-18-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-18-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-18-10">10</a></span>
<span class="normal"><a href="#__codelineno-18-11">11</a></span>
<span class="normal"><a href="#__codelineno-18-12">12</a></span>
<span class="normal"><a href="#__codelineno-18-13">13</a></span>
<span class="normal"><a href="#__codelineno-18-14">14</a></span>
<span class="normal"><a href="#__codelineno-18-15">15</a></span>
<span class="normal"><a href="#__codelineno-18-16">16</a></span>
<span class="normal"><a href="#__codelineno-18-17">17</a></span>
<span class="normal"><a href="#__codelineno-18-18">18</a></span>
<span class="normal"><a href="#__codelineno-18-19">19</a></span>
<span class="normal"><a href="#__codelineno-18-20">20</a></span>
<span class="normal"><a href="#__codelineno-18-21">21</a></span>
<span class="normal"><a href="#__codelineno-18-22">22</a></span>
<span class="normal"><a href="#__codelineno-18-23">23</a></span>
<span class="normal"><a href="#__codelineno-18-24">24</a></span>
<span class="normal"><a href="#__codelineno-18-25">25</a></span>
<span class="normal"><a href="#__codelineno-18-26">26</a></span>
<span class="normal"><a href="#__codelineno-18-27">27</a></span>
<span class="normal"><a href="#__codelineno-18-28">28</a></span>
<span class="normal"><a href="#__codelineno-18-29">29</a></span>
<span class="normal"><a href="#__codelineno-18-30">30</a></span>
<span class="normal"><a href="#__codelineno-18-31">31</a></span>
<span class="normal"><a href="#__codelineno-18-32">32</a></span>
<span class="normal"><a href="#__codelineno-18-33">33</a></span>
<span class="normal"><a href="#__codelineno-18-34">34</a></span>
<span class="normal"><a href="#__codelineno-18-35">35</a></span>
<span class="normal"><a href="#__codelineno-18-36">36</a></span>
<span class="normal"><a href="#__codelineno-18-37">37</a></span>
<span class="normal"><a href="#__codelineno-18-38">38</a></span>
<span class="normal"><a href="#__codelineno-18-39">39</a></span>
<span class="normal"><a href="#__codelineno-18-40">40</a></span>
<span class="normal"><a href="#__codelineno-18-41">41</a></span>
<span class="normal"><a href="#__codelineno-18-42">42</a></span>
<span class="normal"><a href="#__codelineno-18-43">43</a></span>
<span class="normal"><a href="#__codelineno-18-44">44</a></span>
<span class="normal"><a href="#__codelineno-18-45">45</a></span>
<span class="normal"><a href="#__codelineno-18-46">46</a></span>
<span class="normal"><a href="#__codelineno-18-47">47</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="c1">// 管程</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="n">monitor</span><span class="w"> </span><span class="nf">producer_consumer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="w">    </span><span class="n">item</span><span class="w"> </span><span class="n">buffer</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">out</span><span class="p">;</span>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="w">    </span><span class="n">condition</span><span class="w"> </span><span class="n">not_full</span><span class="p">,</span><span class="w"> </span><span class="n">not_empty</span><span class="p">;</span>
<a id="__codelineno-18-6" name="__codelineno-18-6"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="p">;</span>
<a id="__codelineno-18-7" name="__codelineno-18-7"></a><span class="w">    </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-18-8" name="__codelineno-18-8"></a><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">put</span><span class="p">(</span><span class="n">item</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-9" name="__codelineno-18-9"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">count</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="n">c_wait</span><span class="p">(</span><span class="n">not_full</span><span class="p">);</span><span class="w"> </span><span class="c1">// 将该线程挂在not_full条件对应的队列上</span>
<a id="__codelineno-18-10" name="__codelineno-18-10"></a><span class="w">            </span><span class="n">buffer</span><span class="p">[</span><span class="n">in</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-18-11" name="__codelineno-18-11"></a><span class="w">            </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">in</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">N</span><span class="p">;</span>
<a id="__codelineno-18-12" name="__codelineno-18-12"></a><span class="w">            </span><span class="n">count</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-18-13" name="__codelineno-18-13"></a><span class="w">            </span><span class="n">c_signal</span><span class="p">(</span><span class="n">not_empty</span><span class="p">);</span>
<a id="__codelineno-18-14" name="__codelineno-18-14"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-18-15" name="__codelineno-18-15"></a>
<a id="__codelineno-18-16" name="__codelineno-18-16"></a><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-17" name="__codelineno-18-17"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">count</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">c_wait</span><span class="p">(</span><span class="n">not_empty</span><span class="p">);</span><span class="w"> </span><span class="c1">// 将该线程挂载not_empty条件对应的队列上</span>
<a id="__codelineno-18-18" name="__codelineno-18-18"></a><span class="w">            </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer</span><span class="p">[</span><span class="n">out</span><span class="p">];</span>
<a id="__codelineno-18-19" name="__codelineno-18-19"></a><span class="w">            </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">N</span><span class="p">;</span>
<a id="__codelineno-18-20" name="__codelineno-18-20"></a><span class="w">            </span><span class="n">count</span><span class="o">--</span><span class="p">;</span>
<a id="__codelineno-18-21" name="__codelineno-18-21"></a><span class="w">            </span><span class="n">c_signal</span><span class="p">(</span><span class="n">not_full</span><span class="p">);</span>
<a id="__codelineno-18-22" name="__codelineno-18-22"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-18-23" name="__codelineno-18-23"></a>
<a id="__codelineno-18-24" name="__codelineno-18-24"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-18-25" name="__codelineno-18-25"></a><span class="w">            </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-18-26" name="__codelineno-18-26"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-18-27" name="__codelineno-18-27"></a><span class="p">}</span><span class="w"> </span><span class="n">PC</span><span class="p">;</span>
<a id="__codelineno-18-28" name="__codelineno-18-28"></a>
<a id="__codelineno-18-29" name="__codelineno-18-29"></a><span class="c1">// 生产者 &amp;&amp; 消费者线程</span>
<a id="__codelineno-18-30" name="__codelineno-18-30"></a>
<a id="__codelineno-18-31" name="__codelineno-18-31"></a><span class="kt">void</span><span class="w"> </span><span class="nf">producer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-32" name="__codelineno-18-32"></a><span class="w">    </span><span class="n">item</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-18-33" name="__codelineno-18-33"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-34" name="__codelineno-18-34"></a><span class="w">        </span><span class="p">....</span>
<a id="__codelineno-18-35" name="__codelineno-18-35"></a><span class="w">        </span><span class="c1">// produce an item in next_p</span>
<a id="__codelineno-18-36" name="__codelineno-18-36"></a><span class="w">        </span><span class="n">PC</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<a id="__codelineno-18-37" name="__codelineno-18-37"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-18-38" name="__codelineno-18-38"></a><span class="p">}</span>
<a id="__codelineno-18-39" name="__codelineno-18-39"></a>
<a id="__codelineno-18-40" name="__codelineno-18-40"></a><span class="kt">void</span><span class="w"> </span><span class="nf">consumer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-41" name="__codelineno-18-41"></a><span class="w">    </span><span class="n">item</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-18-42" name="__codelineno-18-42"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-43" name="__codelineno-18-43"></a><span class="w">        </span><span class="n">PC</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<a id="__codelineno-18-44" name="__codelineno-18-44"></a><span class="w">        </span><span class="c1">// consumer the item in next_p</span>
<a id="__codelineno-18-45" name="__codelineno-18-45"></a><span class="w">        </span><span class="p">....</span>
<a id="__codelineno-18-46" name="__codelineno-18-46"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-18-47" name="__codelineno-18-47"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><img alt="" src="../images/%E7%94%9F%E4%BA%A7%E8%80%85-%E6%B6%88%E8%B4%B9%E8%80%85%E9%97%AE%E9%A2%98.png" /></p>
<h4 id="-_1">读者-写者问题<a class="headerlink" href="#-_1" title="Permanent link">&para;</a></h4>
<p><ins>问题描述</ins> 一个数据文件或者记录可以被多个进程共享,其中某些线程仅仅是读取其中的内容而不做更改,称为读者线程;另一些不仅要求读还要求更改数据中的内容,称为写者线程. 允许多个读者同时访问数据,但不允许写者和读者\写者共同访问数据.</p>
<ul>
<li><ins class="critic">写者优先(读\写公平)</ins> 如果有写者在等待访问对象,则不允许有新的读者开始读操作</li>
<li><ins class="critic">读者优先</ins> 如果有读者在访问进程,则不管有没有写者,后续读者都可以进行读操作</li>
</ul>
<p><ins>关于读者优先问题的解法</ins></p>
<ul>
<li>设置互斥型信号量<code>w_mutex</code>来控制读\写互斥;设置<code>reader_number</code>来记录当前有多少个读者在读数据;设置互斥变量<code>r_mutex</code>来控制多个读者互斥访问<code>reader_number</code></li>
<li>写者只有在没有读者要读数据的时候才能写数据</li>
</ul>
<p><img alt="" src="../images/%E8%AF%BB%E8%80%85%E4%BC%98%E5%85%88%E9%97%AE%E9%A2%98.png" /></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-19-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-19-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-19-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-19-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-19-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-19-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-19-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-19-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-19-10">10</a></span>
<span class="normal"><a href="#__codelineno-19-11">11</a></span>
<span class="normal"><a href="#__codelineno-19-12">12</a></span>
<span class="normal"><a href="#__codelineno-19-13">13</a></span>
<span class="normal"><a href="#__codelineno-19-14">14</a></span>
<span class="normal"><a href="#__codelineno-19-15">15</a></span>
<span class="normal"><a href="#__codelineno-19-16">16</a></span>
<span class="normal"><a href="#__codelineno-19-17">17</a></span>
<span class="normal"><a href="#__codelineno-19-18">18</a></span>
<span class="normal"><a href="#__codelineno-19-19">19</a></span>
<span class="normal"><a href="#__codelineno-19-20">20</a></span>
<span class="normal"><a href="#__codelineno-19-21">21</a></span>
<span class="normal"><a href="#__codelineno-19-22">22</a></span>
<span class="normal"><a href="#__codelineno-19-23">23</a></span>
<span class="normal"><a href="#__codelineno-19-24">24</a></span>
<span class="normal"><a href="#__codelineno-19-25">25</a></span>
<span class="normal"><a href="#__codelineno-19-26">26</a></span>
<span class="normal"><a href="#__codelineno-19-27">27</a></span>
<span class="normal"><a href="#__codelineno-19-28">28</a></span>
<span class="normal"><a href="#__codelineno-19-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="n">semaphore</span><span class="w"> </span><span class="n">r_mutex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">w_mutex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="kt">int</span><span class="w"> </span><span class="n">reader_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a>
<a id="__codelineno-19-4" name="__codelineno-19-4"></a><span class="c1">// 读线程</span>
<a id="__codelineno-19-5" name="__codelineno-19-5"></a>
<a id="__codelineno-19-6" name="__codelineno-19-6"></a><span class="kt">void</span><span class="w"> </span><span class="nf">reader</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-7" name="__codelineno-19-7"></a><span class="w">    </span><span class="k">do</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-8" name="__codelineno-19-8"></a><span class="w">        </span><span class="n">wait</span><span class="p">(</span><span class="n">r_mutex</span><span class="p">);</span>
<a id="__codelineno-19-9" name="__codelineno-19-9"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">reader_number</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">wait</span><span class="p">(</span><span class="n">w_mutex</span><span class="p">);</span><span class="w"> </span><span class="c1">// 等待写进程完成</span>
<a id="__codelineno-19-10" name="__codelineno-19-10"></a><span class="w">        </span><span class="n">reader_number</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-19-11" name="__codelineno-19-11"></a><span class="w">        </span><span class="n">signal</span><span class="p">(</span><span class="n">r_mutex</span><span class="p">);</span><span class="w"> </span><span class="c1">// 互斥夹紧</span>
<a id="__codelineno-19-12" name="__codelineno-19-12"></a><span class="w">        </span><span class="p">....</span>
<a id="__codelineno-19-13" name="__codelineno-19-13"></a><span class="w">        </span><span class="n">perform</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="n">operation</span><span class="w"> </span><span class="p">;</span>
<a id="__codelineno-19-14" name="__codelineno-19-14"></a><span class="w">        </span><span class="p">....</span>
<a id="__codelineno-19-15" name="__codelineno-19-15"></a><span class="w">        </span><span class="n">wait</span><span class="p">(</span><span class="n">r_mutex</span><span class="p">);</span>
<a id="__codelineno-19-16" name="__codelineno-19-16"></a><span class="w">        </span><span class="n">reader_number</span><span class="o">--</span><span class="p">;</span>
<a id="__codelineno-19-17" name="__codelineno-19-17"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">reader_number</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">signal</span><span class="p">(</span><span class="n">w_mutex</span><span class="p">);</span><span class="w"> </span><span class="c1">// 尝试唤醒写进程</span>
<a id="__codelineno-19-18" name="__codelineno-19-18"></a><span class="w">        </span><span class="n">signal</span><span class="p">(</span><span class="n">r_mutex</span><span class="p">);</span><span class="w"> </span><span class="c1">// 互斥夹紧</span>
<a id="__codelineno-19-19" name="__codelineno-19-19"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
<a id="__codelineno-19-20" name="__codelineno-19-20"></a><span class="p">}</span>
<a id="__codelineno-19-21" name="__codelineno-19-21"></a>
<a id="__codelineno-19-22" name="__codelineno-19-22"></a><span class="c1">// 写线程</span>
<a id="__codelineno-19-23" name="__codelineno-19-23"></a><span class="kt">void</span><span class="w"> </span><span class="nf">writer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-24" name="__codelineno-19-24"></a><span class="w">    </span><span class="k">do</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-25" name="__codelineno-19-25"></a><span class="w">        </span><span class="n">wait</span><span class="p">(</span><span class="n">w_mutex</span><span class="p">);</span>
<a id="__codelineno-19-26" name="__codelineno-19-26"></a><span class="w">        </span><span class="n">perform</span><span class="w"> </span><span class="n">write</span><span class="w"> </span><span class="n">operation</span><span class="p">;</span>
<a id="__codelineno-19-27" name="__codelineno-19-27"></a><span class="w">        </span><span class="n">signal</span><span class="p">(</span><span class="n">w_mutex</span><span class="p">);</span><span class="w"> </span><span class="c1">// 互斥夹紧</span>
<a id="__codelineno-19-28" name="__codelineno-19-28"></a><span class="w">    </span><span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-19-29" name="__codelineno-19-29"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><ins>关于写者优先问题的解法</ins></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-20-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-20-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-20-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-20-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-20-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-20-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-20-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-20-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-20-10">10</a></span>
<span class="normal"><a href="#__codelineno-20-11">11</a></span>
<span class="normal"><a href="#__codelineno-20-12">12</a></span>
<span class="normal"><a href="#__codelineno-20-13">13</a></span>
<span class="normal"><a href="#__codelineno-20-14">14</a></span>
<span class="normal"><a href="#__codelineno-20-15">15</a></span>
<span class="normal"><a href="#__codelineno-20-16">16</a></span>
<span class="normal"><a href="#__codelineno-20-17">17</a></span>
<span class="normal"><a href="#__codelineno-20-18">18</a></span>
<span class="normal"><a href="#__codelineno-20-19">19</a></span>
<span class="normal"><a href="#__codelineno-20-20">20</a></span>
<span class="normal"><a href="#__codelineno-20-21">21</a></span>
<span class="normal"><a href="#__codelineno-20-22">22</a></span>
<span class="normal"><a href="#__codelineno-20-23">23</a></span>
<span class="normal"><a href="#__codelineno-20-24">24</a></span>
<span class="normal"><a href="#__codelineno-20-25">25</a></span>
<span class="normal"><a href="#__codelineno-20-26">26</a></span>
<span class="normal"><a href="#__codelineno-20-27">27</a></span>
<span class="normal"><a href="#__codelineno-20-28">28</a></span>
<span class="normal"><a href="#__codelineno-20-29">29</a></span>
<span class="normal"><a href="#__codelineno-20-30">30</a></span>
<span class="normal"><a href="#__codelineno-20-31">31</a></span>
<span class="normal"><a href="#__codelineno-20-32">32</a></span>
<span class="normal"><a href="#__codelineno-20-33">33</a></span>
<span class="normal"><a href="#__codelineno-20-34">34</a></span>
<span class="normal"><a href="#__codelineno-20-35">35</a></span>
<span class="normal"><a href="#__codelineno-20-36">36</a></span>
<span class="normal"><a href="#__codelineno-20-37">37</a></span>
<span class="normal"><a href="#__codelineno-20-38">38</a></span>
<span class="normal"><a href="#__codelineno-20-39">39</a></span>
<span class="normal"><a href="#__codelineno-20-40">40</a></span>
<span class="normal"><a href="#__codelineno-20-41">41</a></span>
<span class="normal"><a href="#__codelineno-20-42">42</a></span>
<span class="normal"><a href="#__codelineno-20-43">43</a></span>
<span class="normal"><a href="#__codelineno-20-44">44</a></span>
<span class="normal"><a href="#__codelineno-20-45">45</a></span>
<span class="normal"><a href="#__codelineno-20-46">46</a></span>
<span class="normal"><a href="#__codelineno-20-47">47</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="n">semaphore</span><span class="w"> </span><span class="n">r_mutex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">w_mutex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">read_try</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">  </span><span class="c1">// 新增 read_try 信号量</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="kt">int</span><span class="w"> </span><span class="n">reader_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="kt">int</span><span class="w"> </span><span class="n">writer_waiting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">  </span><span class="c1">// 记录是否有写者在等待</span>
<a id="__codelineno-20-4" name="__codelineno-20-4"></a>
<a id="__codelineno-20-5" name="__codelineno-20-5"></a><span class="c1">// 读线程</span>
<a id="__codelineno-20-6" name="__codelineno-20-6"></a><span class="kt">void</span><span class="w"> </span><span class="nf">reader</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-7" name="__codelineno-20-7"></a><span class="w">    </span><span class="k">do</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-8" name="__codelineno-20-8"></a><span class="w">        </span><span class="n">wait</span><span class="p">(</span><span class="n">read_try</span><span class="p">);</span><span class="w">           </span><span class="c1">// 尝试进入读区域，如果写者在等待则阻塞</span>
<a id="__codelineno-20-9" name="__codelineno-20-9"></a><span class="w">        </span><span class="n">wait</span><span class="p">(</span><span class="n">r_mutex</span><span class="p">);</span><span class="w">            </span><span class="c1">// 保护 reader_number 的访问</span>
<a id="__codelineno-20-10" name="__codelineno-20-10"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">reader_number</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">wait</span><span class="p">(</span><span class="n">w_mutex</span><span class="p">);</span><span class="w">  </span><span class="c1">// 如果是第一个读者，等待写者完成</span>
<a id="__codelineno-20-11" name="__codelineno-20-11"></a><span class="w">        </span><span class="n">reader_number</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-20-12" name="__codelineno-20-12"></a><span class="w">        </span><span class="n">signal</span><span class="p">(</span><span class="n">r_mutex</span><span class="p">);</span><span class="w">          </span><span class="c1">// 释放对 reader_number 的互斥访问</span>
<a id="__codelineno-20-13" name="__codelineno-20-13"></a><span class="w">        </span><span class="n">signal</span><span class="p">(</span><span class="n">read_try</span><span class="p">);</span><span class="w">         </span><span class="c1">// 允许其他读者尝试进入</span>
<a id="__codelineno-20-14" name="__codelineno-20-14"></a>
<a id="__codelineno-20-15" name="__codelineno-20-15"></a><span class="w">        </span><span class="c1">// ....</span>
<a id="__codelineno-20-16" name="__codelineno-20-16"></a><span class="w">        </span><span class="n">perform</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="n">operation</span><span class="p">;</span><span class="w">   </span><span class="c1">// 执行读操作</span>
<a id="__codelineno-20-17" name="__codelineno-20-17"></a><span class="w">        </span><span class="c1">// ....</span>
<a id="__codelineno-20-18" name="__codelineno-20-18"></a>
<a id="__codelineno-20-19" name="__codelineno-20-19"></a><span class="w">        </span><span class="n">wait</span><span class="p">(</span><span class="n">r_mutex</span><span class="p">);</span><span class="w">            </span><span class="c1">// 再次进入临界区，准备减少读者数</span>
<a id="__codelineno-20-20" name="__codelineno-20-20"></a><span class="w">        </span><span class="n">reader_number</span><span class="o">--</span><span class="p">;</span>
<a id="__codelineno-20-21" name="__codelineno-20-21"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">reader_number</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">signal</span><span class="p">(</span><span class="n">w_mutex</span><span class="p">);</span><span class="w">  </span><span class="c1">// 如果是最后一个读者，释放 w_mutex</span>
<a id="__codelineno-20-22" name="__codelineno-20-22"></a><span class="w">        </span><span class="n">signal</span><span class="p">(</span><span class="n">r_mutex</span><span class="p">);</span><span class="w">          </span><span class="c1">// 释放互斥锁</span>
<a id="__codelineno-20-23" name="__codelineno-20-23"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
<a id="__codelineno-20-24" name="__codelineno-20-24"></a><span class="p">}</span>
<a id="__codelineno-20-25" name="__codelineno-20-25"></a>
<a id="__codelineno-20-26" name="__codelineno-20-26"></a><span class="c1">// 写线程</span>
<a id="__codelineno-20-27" name="__codelineno-20-27"></a><span class="kt">void</span><span class="w"> </span><span class="nf">writer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-28" name="__codelineno-20-28"></a><span class="w">    </span><span class="k">do</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-29" name="__codelineno-20-29"></a><span class="w">        </span><span class="n">wait</span><span class="p">(</span><span class="n">w_mutex</span><span class="p">);</span><span class="w">            </span><span class="c1">// 确保写操作的互斥</span>
<a id="__codelineno-20-30" name="__codelineno-20-30"></a><span class="w">        </span><span class="n">writer_waiting</span><span class="o">++</span><span class="p">;</span><span class="w">         </span><span class="c1">// 标记有写者在等待</span>
<a id="__codelineno-20-31" name="__codelineno-20-31"></a>
<a id="__codelineno-20-32" name="__codelineno-20-32"></a><span class="w">        </span><span class="n">wait</span><span class="p">(</span><span class="n">r_mutex</span><span class="p">);</span><span class="w">            </span><span class="c1">// 保护 reader_number 的访问</span>
<a id="__codelineno-20-33" name="__codelineno-20-33"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">reader_number</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">wait</span><span class="p">(</span><span class="n">read_try</span><span class="p">);</span><span class="w">  </span><span class="c1">// 如果有读者正在读，阻止新读者进入</span>
<a id="__codelineno-20-34" name="__codelineno-20-34"></a><span class="w">        </span><span class="n">signal</span><span class="p">(</span><span class="n">r_mutex</span><span class="p">);</span><span class="w">          </span><span class="c1">// 释放对 reader_number 的访问</span>
<a id="__codelineno-20-35" name="__codelineno-20-35"></a>
<a id="__codelineno-20-36" name="__codelineno-20-36"></a><span class="w">        </span><span class="c1">// ....</span>
<a id="__codelineno-20-37" name="__codelineno-20-37"></a><span class="w">        </span><span class="n">perform</span><span class="w"> </span><span class="n">write</span><span class="w"> </span><span class="n">operation</span><span class="p">;</span><span class="w">  </span><span class="c1">// 执行写操作</span>
<a id="__codelineno-20-38" name="__codelineno-20-38"></a><span class="w">        </span><span class="c1">// ....</span>
<a id="__codelineno-20-39" name="__codelineno-20-39"></a>
<a id="__codelineno-20-40" name="__codelineno-20-40"></a><span class="w">        </span><span class="n">wait</span><span class="p">(</span><span class="n">r_mutex</span><span class="p">);</span><span class="w">            </span><span class="c1">// 再次进入临界区</span>
<a id="__codelineno-20-41" name="__codelineno-20-41"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">reader_number</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">signal</span><span class="p">(</span><span class="n">read_try</span><span class="p">);</span><span class="w">  </span><span class="c1">// 允许新读者进入（如果之前阻止了）</span>
<a id="__codelineno-20-42" name="__codelineno-20-42"></a><span class="w">        </span><span class="n">signal</span><span class="p">(</span><span class="n">r_mutex</span><span class="p">);</span><span class="w">          </span><span class="c1">// 释放互斥锁</span>
<a id="__codelineno-20-43" name="__codelineno-20-43"></a>
<a id="__codelineno-20-44" name="__codelineno-20-44"></a><span class="w">        </span><span class="n">writer_waiting</span><span class="o">--</span><span class="p">;</span><span class="w">         </span><span class="c1">// 标记写者已完成等待</span>
<a id="__codelineno-20-45" name="__codelineno-20-45"></a><span class="w">        </span><span class="n">signal</span><span class="p">(</span><span class="n">w_mutex</span><span class="p">);</span><span class="w">          </span><span class="c1">// 释放写互斥锁</span>
<a id="__codelineno-20-46" name="__codelineno-20-46"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-20-47" name="__codelineno-20-47"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="_21">哲学家进餐问题<a class="headerlink" href="#_21" title="Permanent link">&para;</a></h4>
<p><ins>问题描述</ins> 有5个哲学家共用1张圆桌,它们分别坐在圆桌周围的5把椅子上,在圆桌上有5个碗和5根筷子,它们的生活方式是交替思考和吃法;平时,一个哲学家进行思考,在饥饿的时候便会试图取用左/右边最靠近自己的筷子来进餐,只有在持有两个筷子的时候才会进餐;进餐完毕,放下筷子思考.</p>
<p><img alt="alt text" src="../images/%E5%93%B2%E5%AD%A6%E5%AE%B6%E8%BF%9B%E9%A4%90.png" /></p>
<p>简单思考,如果所有哲学家都先拿左边筷子再拿右边筷子;当所有哲学家一起想吃饭的时候就或导致死锁.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Python</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-21-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-21-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-21-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-21-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-21-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-21-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-21-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-21-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-21-10">10</a></span>
<span class="normal"><a href="#__codelineno-21-11">11</a></span>
<span class="normal"><a href="#__codelineno-21-12">12</a></span>
<span class="normal"><a href="#__codelineno-21-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="n">mutex</span> <span class="o">=</span> <span class="n">Mutex</span><span class="p">()</span>  <span class="c1"># 用于保护共享资源（筷子）</span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="n">chopsticks</span> <span class="o">=</span> <span class="p">[</span><span class="n">Mutex</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span>  <span class="c1"># 5 根筷子，每根一个互斥锁</span>
<a id="__codelineno-21-3" name="__codelineno-21-3"></a>
<a id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="k">def</span><span class="w"> </span><span class="nf">philosopher</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
<a id="__codelineno-21-5" name="__codelineno-21-5"></a>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-21-6" name="__codelineno-21-6"></a>        <span class="n">think</span><span class="p">()</span>  <span class="c1"># 思考</span>
<a id="__codelineno-21-7" name="__codelineno-21-7"></a>        <span class="c1"># 拿筷子</span>
<a id="__codelineno-21-8" name="__codelineno-21-8"></a>        <span class="n">chopsticks</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>      <span class="c1"># 拿左边的筷子</span>
<a id="__codelineno-21-9" name="__codelineno-21-9"></a>        <span class="n">chopsticks</span><span class="p">[(</span><span class="nb">id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>  <span class="c1"># 拿右边的筷子</span>
<a id="__codelineno-21-10" name="__codelineno-21-10"></a>        <span class="n">eat</span><span class="p">()</span>  <span class="c1"># 进餐</span>
<a id="__codelineno-21-11" name="__codelineno-21-11"></a>        <span class="c1"># 放筷子</span>
<a id="__codelineno-21-12" name="__codelineno-21-12"></a>        <span class="n">chopsticks</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">unlock</span><span class="p">()</span>         <span class="c1"># 放左边的筷子</span>
<a id="__codelineno-21-13" name="__codelineno-21-13"></a>        <span class="n">chopsticks</span><span class="p">[(</span><span class="nb">id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">unlock</span><span class="p">()</span>  <span class="c1"># 放右边的筷子</span>
</code></pre></div></td></tr></table></div>
<p>解决办法有三种</p>
<ul>
<li>只有当哲学家左右两边都有筷子的时候才拿起左边的筷子</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-22-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-22-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-22-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-22-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-22-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-22-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-22-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-22-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-22-10">10</a></span>
<span class="normal"><a href="#__codelineno-22-11">11</a></span>
<span class="normal"><a href="#__codelineno-22-12">12</a></span>
<span class="normal"><a href="#__codelineno-22-13">13</a></span>
<span class="normal"><a href="#__codelineno-22-14">14</a></span>
<span class="normal"><a href="#__codelineno-22-15">15</a></span>
<span class="normal"><a href="#__codelineno-22-16">16</a></span>
<span class="normal"><a href="#__codelineno-22-17">17</a></span>
<span class="normal"><a href="#__codelineno-22-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="n">semaphore</span><span class="w"> </span><span class="n">chopstick</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">};</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="n">semaphore</span><span class="w"> </span><span class="n">mutex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="n">Pi</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="w">    </span><span class="k">do</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-6" name="__codelineno-22-6"></a><span class="w">        </span><span class="n">wait</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span>
<a id="__codelineno-22-7" name="__codelineno-22-7"></a><span class="w">        </span><span class="n">signal</span><span class="p">(</span><span class="n">chopstick</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<a id="__codelineno-22-8" name="__codelineno-22-8"></a><span class="w">        </span><span class="n">signal</span><span class="p">(</span><span class="n">chopstick</span><span class="p">[(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">5</span><span class="p">]);</span>
<a id="__codelineno-22-9" name="__codelineno-22-9"></a><span class="w">        </span><span class="n">signal</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span>
<a id="__codelineno-22-10" name="__codelineno-22-10"></a>
<a id="__codelineno-22-11" name="__codelineno-22-11"></a><span class="w">        </span><span class="n">eat</span><span class="p">();</span>
<a id="__codelineno-22-12" name="__codelineno-22-12"></a>
<a id="__codelineno-22-13" name="__codelineno-22-13"></a><span class="w">        </span><span class="n">signal</span><span class="p">(</span><span class="n">chopstick</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<a id="__codelineno-22-14" name="__codelineno-22-14"></a><span class="w">        </span><span class="n">signal</span><span class="p">(</span><span class="n">chopstick</span><span class="p">[(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">5</span><span class="p">]);</span>
<a id="__codelineno-22-15" name="__codelineno-22-15"></a>
<a id="__codelineno-22-16" name="__codelineno-22-16"></a><span class="w">        </span><span class="n">think</span><span class="p">();</span>
<a id="__codelineno-22-17" name="__codelineno-22-17"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-22-18" name="__codelineno-22-18"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>奇数序号的哲学家先拿左边,偶数序号的哲学家先拿右边</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-23-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-23-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-23-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-23-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-23-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-23-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-23-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-23-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-23-10">10</a></span>
<span class="normal"><a href="#__codelineno-23-11">11</a></span>
<span class="normal"><a href="#__codelineno-23-12">12</a></span>
<span class="normal"><a href="#__codelineno-23-13">13</a></span>
<span class="normal"><a href="#__codelineno-23-14">14</a></span>
<span class="normal"><a href="#__codelineno-23-15">15</a></span>
<span class="normal"><a href="#__codelineno-23-16">16</a></span>
<span class="normal"><a href="#__codelineno-23-17">17</a></span>
<span class="normal"><a href="#__codelineno-23-18">18</a></span>
<span class="normal"><a href="#__codelineno-23-19">19</a></span>
<span class="normal"><a href="#__codelineno-23-20">20</a></span>
<span class="normal"><a href="#__codelineno-23-21">21</a></span>
<span class="normal"><a href="#__codelineno-23-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="c1">// 定义5根筷子的互斥锁</span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="n">semaphore</span><span class="w"> </span><span class="n">chopstick</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">};</span>
<a id="__codelineno-23-3" name="__codelineno-23-3"></a>
<a id="__codelineno-23-4" name="__codelineno-23-4"></a><span class="c1">// 哲学家线程</span>
<a id="__codelineno-23-5" name="__codelineno-23-5"></a><span class="kt">void</span><span class="w"> </span><span class="nf">philosopher</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-6" name="__codelineno-23-6"></a><span class="w">    </span><span class="k">do</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-7" name="__codelineno-23-7"></a><span class="w">        </span><span class="n">think</span><span class="p">();</span><span class="w">  </span><span class="c1">// 思考</span>
<a id="__codelineno-23-8" name="__codelineno-23-8"></a>
<a id="__codelineno-23-9" name="__codelineno-23-9"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// 奇数编号哲学家</span>
<a id="__codelineno-23-10" name="__codelineno-23-10"></a><span class="w">            </span><span class="n">wait</span><span class="p">(</span><span class="n">chopstick</span><span class="p">[</span><span class="n">id</span><span class="p">]);</span><span class="w">      </span><span class="c1">// 先拿左边的筷子</span>
<a id="__codelineno-23-11" name="__codelineno-23-11"></a><span class="w">            </span><span class="n">wait</span><span class="p">(</span><span class="n">chopstick</span><span class="p">[(</span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">5</span><span class="p">]);</span><span class="w">  </span><span class="c1">// 再拿右边的筷子</span>
<a id="__codelineno-23-12" name="__codelineno-23-12"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// 偶数编号哲学家</span>
<a id="__codelineno-23-13" name="__codelineno-23-13"></a><span class="w">            </span><span class="n">wait</span><span class="p">(</span><span class="n">chopstick</span><span class="p">[(</span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">5</span><span class="p">]);</span><span class="w">  </span><span class="c1">// 先拿右边的筷子</span>
<a id="__codelineno-23-14" name="__codelineno-23-14"></a><span class="w">            </span><span class="n">wait</span><span class="p">(</span><span class="n">chopstick</span><span class="p">[</span><span class="n">id</span><span class="p">]);</span><span class="w">      </span><span class="c1">// 再拿左边的筷子</span>
<a id="__codelineno-23-15" name="__codelineno-23-15"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-23-16" name="__codelineno-23-16"></a>
<a id="__codelineno-23-17" name="__codelineno-23-17"></a><span class="w">        </span><span class="n">eat</span><span class="p">();</span><span class="w">  </span><span class="c1">// 进餐</span>
<a id="__codelineno-23-18" name="__codelineno-23-18"></a>
<a id="__codelineno-23-19" name="__codelineno-23-19"></a><span class="w">        </span><span class="n">signal</span><span class="p">(</span><span class="n">chopstick</span><span class="p">[</span><span class="n">id</span><span class="p">]);</span><span class="w">      </span><span class="c1">// 放左边的筷子</span>
<a id="__codelineno-23-20" name="__codelineno-23-20"></a><span class="w">        </span><span class="n">signal</span><span class="p">(</span><span class="n">chopstick</span><span class="p">[(</span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">5</span><span class="p">]);</span><span class="w">  </span><span class="c1">// 放右边的筷子</span>
<a id="__codelineno-23-21" name="__codelineno-23-21"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
<a id="__codelineno-23-22" name="__codelineno-23-22"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>至多允许4名哲学家同时取拿其左边的筷子</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-24-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-24-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-24-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-24-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-24-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-24-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-24-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-24-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-24-10">10</a></span>
<span class="normal"><a href="#__codelineno-24-11">11</a></span>
<span class="normal"><a href="#__codelineno-24-12">12</a></span>
<span class="normal"><a href="#__codelineno-24-13">13</a></span>
<span class="normal"><a href="#__codelineno-24-14">14</a></span>
<span class="normal"><a href="#__codelineno-24-15">15</a></span>
<span class="normal"><a href="#__codelineno-24-16">16</a></span>
<span class="normal"><a href="#__codelineno-24-17">17</a></span>
<span class="normal"><a href="#__codelineno-24-18">18</a></span>
<span class="normal"><a href="#__codelineno-24-19">19</a></span>
<span class="normal"><a href="#__codelineno-24-20">20</a></span>
<span class="normal"><a href="#__codelineno-24-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="c1">// 定义5根筷子的互斥锁</span>
<a id="__codelineno-24-2" name="__codelineno-24-2"></a><span class="n">semaphore</span><span class="w"> </span><span class="n">chopstick</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">};</span>
<a id="__codelineno-24-3" name="__codelineno-24-3"></a><span class="c1">// 限制同时拿筷子的哲学家数量</span>
<a id="__codelineno-24-4" name="__codelineno-24-4"></a><span class="n">semaphore</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<a id="__codelineno-24-5" name="__codelineno-24-5"></a>
<a id="__codelineno-24-6" name="__codelineno-24-6"></a><span class="c1">// 哲学家线程</span>
<a id="__codelineno-24-7" name="__codelineno-24-7"></a><span class="kt">void</span><span class="w"> </span><span class="nf">philosopher</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-24-8" name="__codelineno-24-8"></a><span class="w">    </span><span class="k">do</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-24-9" name="__codelineno-24-9"></a><span class="w">        </span><span class="n">think</span><span class="p">();</span><span class="w">  </span><span class="c1">// 思考</span>
<a id="__codelineno-24-10" name="__codelineno-24-10"></a>
<a id="__codelineno-24-11" name="__codelineno-24-11"></a><span class="w">        </span><span class="n">wait</span><span class="p">(</span><span class="n">limit</span><span class="p">);</span><span class="w">  </span><span class="c1">// 限制同时拿筷子的哲学家数量</span>
<a id="__codelineno-24-12" name="__codelineno-24-12"></a><span class="w">        </span><span class="n">wait</span><span class="p">(</span><span class="n">chopstick</span><span class="p">[</span><span class="n">id</span><span class="p">]);</span><span class="w">      </span><span class="c1">// 拿左边的筷子</span>
<a id="__codelineno-24-13" name="__codelineno-24-13"></a><span class="w">        </span><span class="n">wait</span><span class="p">(</span><span class="n">chopstick</span><span class="p">[(</span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">5</span><span class="p">]);</span><span class="w">  </span><span class="c1">// 拿右边的筷子</span>
<a id="__codelineno-24-14" name="__codelineno-24-14"></a>
<a id="__codelineno-24-15" name="__codelineno-24-15"></a><span class="w">        </span><span class="n">eat</span><span class="p">();</span><span class="w">  </span><span class="c1">// 进餐</span>
<a id="__codelineno-24-16" name="__codelineno-24-16"></a>
<a id="__codelineno-24-17" name="__codelineno-24-17"></a><span class="w">        </span><span class="n">signal</span><span class="p">(</span><span class="n">chopstick</span><span class="p">[</span><span class="n">id</span><span class="p">]);</span><span class="w">      </span><span class="c1">// 放左边的筷子</span>
<a id="__codelineno-24-18" name="__codelineno-24-18"></a><span class="w">        </span><span class="n">signal</span><span class="p">(</span><span class="n">chopstick</span><span class="p">[(</span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">5</span><span class="p">]);</span><span class="w">  </span><span class="c1">// 放右边的筷子</span>
<a id="__codelineno-24-19" name="__codelineno-24-19"></a><span class="w">        </span><span class="n">signal</span><span class="p">(</span><span class="n">limit</span><span class="p">);</span><span class="w">  </span><span class="c1">// 释放限制</span>
<a id="__codelineno-24-20" name="__codelineno-24-20"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
<a id="__codelineno-24-21" name="__codelineno-24-21"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="new">(new) 多处理机调度<a class="headerlink" href="#new" title="Permanent link">&para;</a></h2>
<p><ins>非对称多处理机(AMP)</ins> </p>
<p><ins>对称多处理机(SMP)</ins> 所有处理机都是相同的,有调度程序将任何一个进程分配给任何一个CPU. </p>
<p><ins>处理器的亲和性</ins> 应该让同一进程运行在同一处理器上,而非运行在不同处理器</p>
<p><ins>负载均衡</ins> 保证所有CPU上的进程\吞吐量应该均衡</p>
<h3 id="_22">多处理器调度方案<a class="headerlink" href="#_22" title="Permanent link">&para;</a></h3>
<p><ins class="critic">公共就绪队列</ins> 所有CPU共享一个公共就绪队列.</p>
<ul>
<li>优点是很好的实现了复杂均衡,只要CPU一有空闲就可以去就绪队列上找进程执行</li>
<li>缺点是处理器亲和性较差, 同一进程可能被频繁调度到不同CPU上执行</li>
</ul>
<p><ins class="critic">私有就绪队列</ins> 为每个CPU设定一个专属于自己的私有就绪队列</p>
<ul>
<li>这种实现的负载均衡能力较差,提高负载均的方法有<ul>
<li>推迁移\拉迁移 一个特定的系统程序周期性的检测每个CPU的负载,若发现不平衡则从超载的CPU中推一些进程到空闲CPU的就绪队列中;若一个CPU负载很低,则从其他CPU的就绪队列中拉一些进程.</li>
</ul>
</li>
</ul>







  
  


<!--
  Copyright (c) 2016-2023 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Determine feedback configuration -->


<!-- Determine whether to show feedback -->


<!-- Was this page helpful? -->


                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <!-- Footer -->
<footer class="md-footer">
  <!-- Link to previous and/or next page -->
    
  <nav
    class="md-footer__inner md-grid"
    aria-label="页脚"
    
  >
    <!-- Link to previous page -->
     
    <a
      href="../chapter%201/"
      class="md-footer__link md-footer__link--prev"
      aria-label="上一页: 绪论"
    >
      <div class="md-footer__button md-icon">
         <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </div>
      <div class="md-footer__title">
        <span class="md-footer__direction"> 上一页 </span>
        <div class="md-ellipsis">绪论</div>
      </div>
    </a>
    

    <!-- Link to next page -->
     
    <a
      href="../chapter%203/"
      class="md-footer__link md-footer__link--next"
      aria-label="下一页: 内存管理"
    >
      <div class="md-footer__title">
        <span class="md-footer__direction"> 下一页 </span>
        <div class="md-ellipsis">内存管理</div>
      </div>
      <div class="md-footer__button md-icon">
         <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
      </div>
    </a>
    
  </nav>
   

  <!-- Further information -->
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025~2026 Weary Bird
    </div>
  
  
</div>
      <div class="footer-visit-count">
        <span>本站访问量：</span>
        <script async src="//finicounter.eu.org/finicounter.js"></script>
        <span id="finicount_views"></span>
      </div>
      <style>
        .footer-visit-count {
          display: flex;
          flex-wrap: wrap;
          justify-content: center;
          align-items: center;
          min-height: 40px;
          gap: 0.5em;
        }
        @media (max-width: 768px) {
          .runtime-info {
            display: none;
          }
          .icp-link {
            display: block;
            text-align: center;
          }
        }
      </style>

      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["announce.dismiss", "navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.top", "navigation.footer", "search.suggest", "search.highlight", "search.share", "navigation.expand", "navigation.indexes", "content.tabs.link", "content.tooltips", "content.code.copy", "content.action.edit", "content.action.view", "content.code.annotate"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.56ea9cef.min.js"></script>
      
        <script src="../../../javascripts/extra.js"></script>
      
        <script src="../../../javascripts/latex.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="../../../javascripts/favicons.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>